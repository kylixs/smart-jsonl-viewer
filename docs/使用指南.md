# JSONL Viewer 使用指南

## 快速开始

### 安装扩展

1. **克隆项目并构建**
   ```bash
   git clone <repository-url>
   cd jsonline-viewer
   npm install
   npm run build
   ```

2. **加载扩展到 Chrome**
   - 打开 Chrome 浏览器
   - 访问 `chrome://extensions/`
   - 开启右上角的"开发者模式"
   - 点击"加载已解压的扩展程序"
   - 选择项目的 `dist` 目录

3. **开始使用**
   - 点击浏览器工具栏中的扩展图标
   - 或直接访问包含 JSON/JSONL 的网页

---

## 核心功能使用

### 1. 查看本地文件

#### 方式一：拖拽上传
1. 点击扩展图标打开查看器
2. 将 `.jsonl`、`.json` 或 `.ndjson` 文件拖拽到上传区域
3. 文件内容会自动解析并显示

#### 方式二：选择文件
1. 点击"或点击选择文件"按钮
2. 在文件选择器中选择文件
3. 文件加载后自动显示

### 2. 查看网页 JSON 响应

扩展会自动拦截以下类型的网页：
- Content-Type: `application/json`
- Content-Type: `text/plain`（且内容为有效的 JSON/JSONL）

当访问这类页面时，扩展会：
1. 检测页面内容是否为 JSON 或 JSONL
2. 自动替换页面为查看器界面
3. 美化显示 JSON 数据

**示例场景**：
- API 接口响应（如 `https://api.example.com/data.jsonl`）
- JSON 文件链接（如 `https://example.com/data.json`）
- 任何返回纯 JSON 的网页

---

## 功能详解

### 展开/折叠

#### 行级展开
- **点击行号**：展开/折叠单行 JSON 数据
- **展开图标 ▶/▼**：显示展开状态

#### 节点展开
- 在展开的行内部，可以继续展开/折叠嵌套的对象和数组
- 支持无限层级嵌套

#### 全局控制
- **工具栏 📂 按钮**：全部展开
- **工具栏 📁 按钮**：全部折叠

### 字符串解码

#### 自动解码模式
扩展会自动识别以下类型的字符串并提供解码功能：

1. **转义字符串**
   - 包含 `\n`（换行）
   - 包含 `\"`（双引号）
   - 包含 `\t`（制表符）
   - 包含 `\r`（回车）

2. **嵌套 JSON 字符串**
   - 字符串内容本身是有效的 JSON 对象或数组
   - 支持递归解码多层嵌套

#### 解码显示
- **解码标记** 📝：表示该字符串已被解码
- **黄色背景**：高亮显示解码后的内容
- **切换按钮**：
  - `🔄 Decode`：显示解码后的内容
  - `↩ Raw`：显示原始转义字符串

**示例**：
```json
{
  "message": "Hello\\nWorld"
}
```
解码后显示为：
```
Hello
World
```

### 搜索过滤

#### 按行过滤
1. 在搜索框输入关键字
2. 选择"按行过滤"模式
3. 结果：显示包含关键字的整行数据

**适用场景**：快速定位包含特定内容的行

#### 按节点过滤
1. 在搜索框输入关键字
2. 选择"按节点过滤"模式
3. 结果：只显示匹配的叶子节点及其完整路径

**适用场景**：
- 精确查找特定字段
- 在大型 JSON 中定位嵌套值
- 查看关键字在数据中的位置

#### 解码内容搜索
- **勾选"包含解码后的内容"**：在解码后的字符串中搜索
- **取消勾选**：仅搜索原始内容

**示例**：
如果 JSON 中有：
```json
{
  "data": "Line 1\\nLine 2\\nKeyword Here"
}
```
搜索 "Keyword"：
- 勾选解码搜索：✅ 能找到（在解码后的内容中）
- 取消勾选：❌ 找不到（原始字符串中没有）

#### 搜索统计
过滤后会显示：
```
显示 5 / 100 行
```
表示从 100 行中过滤出 5 行匹配结果

---

## 高级功能

### 主题切换

- **工具栏 🌙 按钮**：切换到暗色主题
- **工具栏 ☀️ 按钮**：切换到亮色主题
- 主题设置会自动保存到本地存储

### 数据导出

1. 点击工具栏 💾 按钮
2. 导出格式：
   - JSONL 文件 → `export.jsonl`
   - JSON 文件 → `export.json`
3. 如果有搜索过滤，导出的是过滤后的数据

**用途**：
- 提取符合条件的数据
- 备份重要内容
- 二次处理

---

## 快捷键（计划中）

| 快捷键 | 功能 |
|--------|------|
| `Ctrl+F` | 聚焦搜索框 |
| `Ctrl+E` | 全部展开 |
| `Ctrl+C` | 全部折叠 |
| `Esc` | 清空搜索 |

---

## 常见问题

### 1. 为什么网页没有自动美化？

**可能原因**：
- 页面 Content-Type 不是 `application/json` 或 `text/plain`
- 内容不是有效的 JSON 或 JSONL 格式
- 页面内容为空

**解决方法**：
- 手动复制内容，通过扩展图标打开查看器，然后粘贴到上传区域
- 保存为文件后上传

### 2. 搜索没有结果？

**检查项**：
- 关键字是否正确（区分大小写）
- 尝试切换过滤模式（行/节点）
- 确认是否勾选"包含解码后的内容"
- 查看原始数据是否真的包含该关键字

### 3. 性能问题：大文件加载慢？

**建议**：
- 当前版本针对小文件优化（< 10MB）
- 大文件支持（虚拟滚动）将在后续版本中添加
- 可以先过滤后再展开查看

### 4. 解码功能不工作？

**确认**：
- 字符串是否真的包含转义字符
- 点击 `🔄 Decode` 按钮
- 嵌套 JSON 字符串格式是否正确

---

## 技巧和最佳实践

### 1. 高效查找
- 先用"按行过滤"快速定位数据行
- 再用"按节点过滤"精确查找字段

### 2. 数据分析
- 使用搜索过滤提取关键数据
- 导出过滤结果进行二次分析

### 3. 调试 API
- 直接在浏览器中访问 API endpoint
- 扩展自动美化响应，方便调试

### 4. 处理日志文件
- 将 JSONL 格式的日志文件拖拽进查看器
- 使用搜索快速定位错误或特定事件

---

## 反馈与支持

- **问题报告**：[GitHub Issues](https://github.com/your-repo/issues)
- **功能建议**：欢迎提交 PR 或 Issue
- **技术文档**：查看 [docs/技术方案.md](技术方案.md)
