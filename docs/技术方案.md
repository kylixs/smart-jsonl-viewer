# JSONL Viewer Chrome æ‰©å±• - å®æ–½æ–¹æ¡ˆ

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### æ ¸å¿ƒåŠŸèƒ½
1. å±•å¼€/æŠ˜å  JSON Lines å’Œ JSON å±‚æ¬¡ç»“æ„
2. æ™ºèƒ½é€’å½’è§£ç å¤æ‚å­—ç¬¦ä¸²ï¼ˆ`\n`ã€`\"`ç­‰è½¬ä¹‰å­—ç¬¦ï¼‰
3. æ”¯æŒæŸ¥æ‰¾è¿‡æ»¤ï¼ˆåŸå§‹å†…å®¹ + è§£ç åå†…å®¹ï¼‰
4. ä¸¤ç§è¿‡æ»¤æ¨¡å¼ï¼šæŒ‰è¡Œè¿‡æ»¤ / æŒ‰å¶å­èŠ‚ç‚¹è¿‡æ»¤

### ä½¿ç”¨åœºæ™¯
- **åœºæ™¯ A**ï¼šæ‰“å¼€æœ¬åœ° `.jsonl` æ–‡ä»¶æŸ¥çœ‹
- **åœºæ™¯ B**ï¼šè‡ªåŠ¨ç¾åŒ–ç½‘é¡µä¸­çš„ JSONL API å“åº”ï¼ˆç±»ä¼¼ JSONViewï¼‰

---

## äºŒã€æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ
- **æ¡†æ¶**ï¼šVue 3 + TypeScript
- **æ„å»ºå·¥å…·**ï¼šVite
- **UI ç»„ä»¶åº“**ï¼šæ— ï¼ˆä½¿ç”¨åŸç”Ÿ CSSï¼Œä¿æŒè½»é‡ï¼‰
- **çŠ¶æ€ç®¡ç†**ï¼šPiniaï¼ˆè½»é‡çº§ï¼‰
- **è™šæ‹Ÿåˆ—è¡¨**ï¼švue-virtual-scrollerï¼ˆå¯é€‰ï¼Œå¦‚éœ€åç»­æ”¯æŒå¤§æ–‡ä»¶ï¼‰

### Chrome æ‰©å±•æ¶æ„

```
chrome-extension/
â”œâ”€â”€ manifest.json              # V3 æ¸…å•æ–‡ä»¶
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ content/               # å†…å®¹è„šæœ¬ï¼ˆæ‹¦æˆªç½‘é¡µ JSONLï¼‰
â”‚   â”‚   â””â”€â”€ content.ts
â”‚   â”œâ”€â”€ viewer/                # æŸ¥çœ‹å™¨ä¸»ç•Œé¢
â”‚   â”‚   â”œâ”€â”€ App.vue
â”‚   â”‚   â”œâ”€â”€ main.ts
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ JsonLineItem.vue      # å•è¡Œ JSON ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ JsonTree.vue          # JSON æ ‘å½¢ç»“æ„
â”‚   â”‚   â”‚   â”œâ”€â”€ StringDecoder.vue     # å­—ç¬¦ä¸²è§£ç å™¨
â”‚   â”‚   â”‚   â””â”€â”€ SearchFilter.vue      # æœç´¢è¿‡æ»¤å™¨
â”‚   â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”‚   â””â”€â”€ jsonlStore.ts         # æ•°æ®çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â”œâ”€â”€ decoder.ts            # é€’å½’è§£ç é€»è¾‘
â”‚   â”‚       â”œâ”€â”€ filter.ts             # è¿‡æ»¤é€»è¾‘
â”‚   â”‚       â””â”€â”€ parser.ts             # JSONL è§£æ
â”‚   â”œâ”€â”€ background/            # åå°è„šæœ¬
â”‚   â”‚   â””â”€â”€ background.ts
â”‚   â””â”€â”€ popup/                 # å¼¹å‡ºçª—å£ï¼ˆå¯é€‰ï¼‰
â”‚       â””â”€â”€ popup.vue
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ icons/                 # æ‰©å±•å›¾æ ‡
â”‚   â””â”€â”€ viewer.html            # æŸ¥çœ‹å™¨ HTML æ¨¡æ¿
â””â”€â”€ vite.config.ts
```

---

## ä¸‰ã€æ ¸å¿ƒåŠŸèƒ½è®¾è®¡

### 3.1 å±•å¼€/æŠ˜å æœºåˆ¶

#### æ•°æ®ç»“æ„
```typescript
interface JsonLineNode {
  id: string;                    // å”¯ä¸€æ ‡è¯†
  lineNumber: number;            // åŸå§‹è¡Œå·
  rawContent: string;            // åŸå§‹ JSON å­—ç¬¦ä¸²
  parsedData: any;               // è§£æåçš„å¯¹è±¡
  isExpanded: boolean;           // å±•å¼€çŠ¶æ€
  decodedStrings: Map<string, DecodedString>; // è§£ç åçš„å­—ç¬¦ä¸²ç¼“å­˜
}

interface JsonNode {
  key: string;
  value: any;
  type: 'object' | 'array' | 'string' | 'number' | 'boolean' | 'null';
  isExpanded: boolean;
  children?: JsonNode[];
  depth: number;
  isDecodable: boolean;          // æ˜¯å¦ä¸ºå¯è§£ç çš„ JSON å­—ç¬¦ä¸²
  decodedValue?: any;            // è§£ç åçš„å€¼
}
```

#### å®ç°æ–¹å¼
- **è¡Œçº§æŠ˜å **ï¼šç‚¹å‡»è¡Œå·æˆ–ç®­å¤´å›¾æ ‡åˆ‡æ¢æ•´è¡Œçš„å±•å¼€çŠ¶æ€
- **èŠ‚ç‚¹æŠ˜å **ï¼šJSON æ ‘ä¸­æ¯ä¸ªå¯¹è±¡/æ•°ç»„èŠ‚ç‚¹å¯ç‹¬ç«‹æŠ˜å 
- **é€’å½’æ¸²æŸ“**ï¼šä½¿ç”¨é€’å½’ç»„ä»¶ `<JsonTree>` æ¸²æŸ“åµŒå¥—ç»“æ„

### 3.2 æ™ºèƒ½å­—ç¬¦ä¸²è§£ç 

#### è§£ç ç­–ç•¥
```typescript
// utils/decoder.ts
export function smartDecode(value: any): DecodedResult {
  if (typeof value !== 'string') {
    return { type: 'primitive', value };
  }

  // æ£€æµ‹æ˜¯å¦ä¸º JSON å­—ç¬¦ä¸²
  if (isJsonString(value)) {
    try {
      const parsed = JSON.parse(value);
      // é€’å½’è§£ç åµŒå¥—çš„ JSON å­—ç¬¦ä¸²
      return {
        type: 'json',
        original: value,
        decoded: smartDecode(parsed),
        displayMode: 'decoded' // æˆ– 'original'
      };
    } catch (e) {
      return { type: 'string', value };
    }
  }

  // å¤„ç†æ™®é€šè½¬ä¹‰å­—ç¬¦ä¸²
  return {
    type: 'string',
    value,
    displayValue: unescapeString(value) // å¤„ç† \n, \", \t ç­‰
  };
}

function isJsonString(str: string): boolean {
  const trimmed = str.trim();
  return (trimmed.startsWith('{') && trimmed.endsWith('}')) ||
         (trimmed.startsWith('[') && trimmed.endsWith(']'));
}
```

#### æ˜¾ç¤ºæ¨¡å¼
- **è‡ªåŠ¨è§£ç æ¨¡å¼**ï¼ˆé»˜è®¤ï¼‰ï¼šè‡ªåŠ¨æ˜¾ç¤ºè§£ç åçš„å†…å®¹
- **åŸå§‹æ¨¡å¼**ï¼šæ˜¾ç¤ºåŸå§‹è½¬ä¹‰å­—ç¬¦ä¸²
- **åˆ‡æ¢æŒ‰é’®**ï¼šæ¯ä¸ªå¯è§£ç å­—ç¬¦ä¸²æ—è¾¹æœ‰ "Raw/Decoded" åˆ‡æ¢æŒ‰é’®

### 3.3 æŸ¥æ‰¾è¿‡æ»¤åŠŸèƒ½

#### è¿‡æ»¤æ¨¡å¼
1. **è¡Œæ¨¡å¼**ï¼šåªæ˜¾ç¤ºåŒ…å«å…³é”®å­—çš„æ•´è¡Œ
2. **èŠ‚ç‚¹æ¨¡å¼**ï¼šåªæ˜¾ç¤ºåŒ…å«å…³é”®å­—çš„å¶å­èŠ‚ç‚¹ï¼ˆåŠå…¶è·¯å¾„ï¼‰

#### å®ç°é€»è¾‘
```typescript
// utils/filter.ts
export function filterJsonLines(
  lines: JsonLineNode[],
  keyword: string,
  mode: 'line' | 'node',
  searchDecoded: boolean = true
): JsonLineNode[] {
  if (mode === 'line') {
    return lines.filter(line =>
      matchInLine(line, keyword, searchDecoded)
    );
  } else {
    return lines.map(line => ({
      ...line,
      parsedData: filterNodes(line.parsedData, keyword, searchDecoded)
    })).filter(line => line.parsedData !== null);
  }
}

function matchInLine(line: JsonLineNode, keyword: string, searchDecoded: boolean): boolean {
  // æœç´¢åŸå§‹å†…å®¹
  if (line.rawContent.includes(keyword)) return true;

  // æœç´¢è§£ç åçš„å†…å®¹
  if (searchDecoded) {
    return searchInDecodedContent(line.parsedData, keyword);
  }

  return false;
}

function filterNodes(node: any, keyword: string, searchDecoded: boolean): any {
  // é€’å½’è¿‡æ»¤ï¼Œåªä¿ç•™åŒ¹é…çš„å¶å­èŠ‚ç‚¹åŠå…¶è·¯å¾„
  // å®ç°ç»†èŠ‚ç•¥...
}
```

#### UI è®¾è®¡
```
â”Œâ”€ æœç´¢æ  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ğŸ”] è¾“å…¥å…³é”®å­—...               â”‚
â”‚ â—‹ æŒ‰è¡Œè¿‡æ»¤  â— æŒ‰èŠ‚ç‚¹è¿‡æ»¤        â”‚
â”‚ â˜‘ åŒ…å«è§£ç åçš„å†…å®¹              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.4 Chrome æ‰©å±•é›†æˆ

#### åœºæ™¯ Aï¼šæœ¬åœ°æ–‡ä»¶æŸ¥çœ‹
```typescript
// viewer/App.vue
const handleFileUpload = async (file: File) => {
  const text = await file.text();
  const lines = text.split('\n').filter(line => line.trim());

  store.loadJsonLines(lines.map((line, index) => ({
    id: `line-${index}`,
    lineNumber: index + 1,
    rawContent: line,
    parsedData: JSON.parse(line),
    isExpanded: false,
    decodedStrings: new Map()
  })));
};
```

- åœ¨ `viewer.html` æ·»åŠ æ–‡ä»¶ä¸Šä¼ /æ‹–æ‹½åŒºåŸŸ
- æ”¯æŒ `.jsonl`ã€`.json`ï¼ˆæ¯è¡Œä¸€ä¸ªå¯¹è±¡ï¼‰ã€`.ndjson` æ ¼å¼

#### åœºæ™¯ Bï¼šç½‘é¡µ JSONL æ‹¦æˆª
```typescript
// content/content.ts
const detectJsonl = (text: string): boolean => {
  const lines = text.trim().split('\n');
  if (lines.length < 2) return false;

  return lines.every(line => {
    try {
      JSON.parse(line);
      return true;
    } catch {
      return false;
    }
  });
};

// æ‹¦æˆªç½‘é¡µå†…å®¹
if (document.contentType === 'application/json' ||
    document.contentType === 'text/plain') {
  const bodyText = document.body.innerText;

  if (detectJsonl(bodyText)) {
    // æ›¿æ¢é¡µé¢ä¸ºæŸ¥çœ‹å™¨
    chrome.runtime.sendMessage({
      type: 'RENDER_JSONL',
      data: bodyText
    });
  }
}
```

```json
// manifest.json
{
  "manifest_version": 3,
  "name": "JSONL Viewer",
  "version": "1.0.0",
  "description": "æ™ºèƒ½ JSONL æŸ¥çœ‹å™¨ï¼Œæ”¯æŒå­—ç¬¦ä¸²è§£ç å’Œé«˜çº§è¿‡æ»¤",
  "permissions": ["storage"],
  "content_scripts": [{
    "matches": ["<all_urls>"],
    "js": ["content.js"],
    "run_at": "document_end"
  }],
  "web_accessible_resources": [{
    "resources": ["viewer.html"],
    "matches": ["<all_urls>"]
  }]
}
```

---

## å››ã€UI/UX è®¾è®¡

### è§†è§‰é£æ ¼
- **ä¸»é¢˜**ï¼šæ”¯æŒäº®è‰²/æš—è‰²ä¸»é¢˜åˆ‡æ¢
- **é…è‰²**ï¼šå‚è€ƒ VSCode JSON è¯­æ³•é«˜äº®
  - å¯¹è±¡é”®ï¼šæ·¡è“è‰² `#9CDCFE`
  - å­—ç¬¦ä¸²ï¼šæ©™è‰² `#CE9178`
  - æ•°å­—ï¼šç»¿è‰² `#B5CEA8`
  - å¸ƒå°”å€¼ï¼šç´«è‰² `#569CD6`
  - è§£ç æ ‡è®°ï¼šé»„è‰²èƒŒæ™¯ `#FFF3CD`

### äº¤äº’è®¾è®¡
1. **è¡Œå·åŒºåŸŸ**ï¼šæ˜¾ç¤ºåŸå§‹è¡Œå·ï¼Œå¯ç‚¹å‡»æŠ˜å 
2. **JSON æ ‘åŒºåŸŸ**ï¼šä½¿ç”¨ç¼©è¿›æ˜¾ç¤ºå±‚çº§å…³ç³»
3. **å·¥å…·æ **ï¼š
   - æœç´¢æ¡†
   - è¿‡æ»¤æ¨¡å¼åˆ‡æ¢
   - ä¸»é¢˜åˆ‡æ¢
   - å…¨éƒ¨å±•å¼€/æŠ˜å æŒ‰é’®
   - å¯¼å‡ºåŠŸèƒ½ï¼ˆå¯¼å‡ºè¿‡æ»¤åçš„æ•°æ®ï¼‰

### ç¤ºä¾‹ç•Œé¢

```
â”Œâ”€ JSONL Viewer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ğŸ“‚ æ‰“å¼€æ–‡ä»¶] [ğŸ” æœç´¢] [âš™ï¸ è®¾ç½®] [ğŸŒ™ ä¸»é¢˜]          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœç´¢: [____________] â—‹è¡Œæ¨¡å¼ â—èŠ‚ç‚¹æ¨¡å¼ â˜‘è§£ç å†…å®¹   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1  â–¼ { type: "file-history-snapshot", ...           â”‚
â”‚       â”œâ”€ type: "file-history-snapshot"               â”‚
â”‚       â”œâ”€ messageId: "0050ba14-338f-..."             â”‚
â”‚       â””â”€ snapshot: â–¶ {...}                           â”‚
â”‚                                                       â”‚
â”‚ 2  â–¼ { parentUuid: null, ...                        â”‚
â”‚       â”œâ”€ message: â–¼                                  â”‚
â”‚       â”‚   â”œâ”€ role: "user"                            â”‚
â”‚       â”‚   â””â”€ content: "Caveat: The messages..."     â”‚
â”‚       â”‚       [ğŸ”„ æ˜¾ç¤ºè§£ç å†…å®¹]                      â”‚
â”‚       â””â”€ ...                                         â”‚
â”‚                                                       â”‚
â”‚ 3  â–¶ { parentUuid: "6d5b038a...", ...               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
å…± 1024 è¡Œï¼Œæ˜¾ç¤º 3 è¡Œï¼ˆè¿‡æ»¤åï¼‰
```

---

## äº”ã€å®æ–½æ­¥éª¤

### Phase 1: é¡¹ç›®æ­å»ºï¼ˆ1 å¤©ï¼‰
- [x] åˆå§‹åŒ– Vite + Vue 3 + TypeScript é¡¹ç›®
- [x] é…ç½® Chrome æ‰©å±•å¼€å‘ç¯å¢ƒ
- [x] åˆ›å»ºåŸºç¡€ç›®å½•ç»“æ„
- [x] è®¾ç½® ESLint + Prettier

### Phase 2: æ ¸å¿ƒç»„ä»¶å¼€å‘ï¼ˆ3 å¤©ï¼‰
- [ ] `JsonLineItem.vue` - å•è¡Œ JSON æ˜¾ç¤ºç»„ä»¶
- [ ] `JsonTree.vue` - é€’å½’æ ‘å½¢ç»“æ„ç»„ä»¶
- [ ] `StringDecoder.vue` - å­—ç¬¦ä¸²è§£ç ç»„ä»¶
- [ ] å®ç°æ™ºèƒ½è§£ç ç®—æ³• `decoder.ts`

### Phase 3: è¿‡æ»¤åŠŸèƒ½ï¼ˆ2 å¤©ï¼‰
- [ ] `SearchFilter.vue` - æœç´¢è¿‡æ»¤ UI
- [ ] `filter.ts` - å®ç°ä¸¤ç§è¿‡æ»¤æ¨¡å¼
- [ ] é›†æˆè§£ç å†…å®¹æœç´¢

### Phase 4: Chrome æ‰©å±•é›†æˆï¼ˆ2 å¤©ï¼‰
- [ ] Content Script - æ‹¦æˆªç½‘é¡µ JSONL
- [ ] æœ¬åœ°æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
- [ ] Manifest V3 é…ç½®

### Phase 5: UI/UX ä¼˜åŒ–ï¼ˆ1 å¤©ï¼‰
- [ ] ä¸»é¢˜åˆ‡æ¢
- [ ] è¯­æ³•é«˜äº®
- [ ] å“åº”å¼å¸ƒå±€
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆè™šæ‹Ÿæ»šåŠ¨å¯é€‰ï¼‰

### Phase 6: æµ‹è¯•ä¸å‘å¸ƒï¼ˆ1 å¤©ï¼‰
- [ ] åŠŸèƒ½æµ‹è¯•
- [ ] ä¸åŒ JSONL æ ¼å¼å…¼å®¹æ€§æµ‹è¯•
- [ ] æ‰“åŒ…å¹¶å‘å¸ƒåˆ° Chrome Web Store

---

## å…­ã€å…³é”®æŠ€æœ¯éš¾ç‚¹

### 6.1 é€’å½’è§£ç æ€§èƒ½
**é—®é¢˜**ï¼šæ·±å±‚åµŒå¥—çš„ JSON å­—ç¬¦ä¸²é€’å½’è§£æå¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨ç¼“å­˜æœºåˆ¶ï¼Œé¿å…é‡å¤è§£æ
- é™åˆ¶æœ€å¤§é€’å½’æ·±åº¦ï¼ˆé»˜è®¤ 10 å±‚ï¼‰
- æ‡’åŠ è½½ï¼šä»…åœ¨ç”¨æˆ·å±•å¼€èŠ‚ç‚¹æ—¶æ‰è§£æå­èŠ‚ç‚¹

### 6.2 å¤§æ–‡ä»¶å¤„ç†ï¼ˆæœªæ¥æ‰©å±•ï¼‰
è™½ç„¶å½“å‰ä¸éœ€è¦ï¼Œä½†é¢„ç•™æ‰©å±•æ€§ï¼š
- ä½¿ç”¨ `vue-virtual-scroller` å®ç°è™šæ‹Ÿæ»šåŠ¨
- åˆ†é¡µåŠ è½½ï¼šæ¯æ¬¡åªåŠ è½½ 100-500 è¡Œ
- Web Worker è§£æå¤§æ–‡ä»¶

### 6.3 Content Script æ³¨å…¥
**é—®é¢˜**ï¼šContent Script éœ€è¦è®¿é—®é¡µé¢ DOM ä½†æƒé™å—é™

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// ä½¿ç”¨ iframe éš”ç¦»æŸ¥çœ‹å™¨
const iframe = document.createElement('iframe');
iframe.src = chrome.runtime.getURL('viewer.html');
iframe.style.cssText = 'position:fixed; top:0; left:0; width:100%; height:100%; border:none; z-index:999999;';
document.body.innerHTML = '';
document.body.appendChild(iframe);

// é€šè¿‡ postMessage ä¼ é€’æ•°æ®
iframe.onload = () => {
  iframe.contentWindow?.postMessage({
    type: 'LOAD_JSONL',
    data: bodyText
  }, '*');
};
```

---

## ä¸ƒã€å…³é”®æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒæ–‡ä»¶
1. **`manifest.json`** - Chrome æ‰©å±•é…ç½®æ–‡ä»¶
2. **`src/viewer/App.vue`** - ä¸»åº”ç”¨å…¥å£
3. **`src/utils/decoder.ts`** - æ™ºèƒ½è§£ç æ ¸å¿ƒé€»è¾‘
4. **`src/utils/filter.ts`** - è¿‡æ»¤ç®—æ³•å®ç°
5. **`src/components/JsonTree.vue`** - é€’å½’æ ‘å½¢ç»“æ„ç»„ä»¶

### é…ç½®æ–‡ä»¶
- `vite.config.ts` - æ„å»ºé…ç½®ï¼ˆéœ€è¦é…ç½®å¤šå…¥å£ï¼‰
- `tsconfig.json` - TypeScript é…ç½®
- `package.json` - ä¾èµ–ç®¡ç†

---

## å…«ã€å¯é€‰å¢å¼ºåŠŸèƒ½

1. **å¯¼å‡ºåŠŸèƒ½**ï¼šå¯¼å‡ºè¿‡æ»¤åçš„æ•°æ®ä¸ºæ–°çš„ JSONL æ–‡ä»¶
2. **å†å²è®°å½•**ï¼šè®°å½•æœ€è¿‘æ‰“å¼€çš„æ–‡ä»¶
3. **è‡ªå®šä¹‰é…è‰²**ï¼šå…è®¸ç”¨æˆ·è‡ªå®šä¹‰è¯­æ³•é«˜äº®é¢œè‰²
4. **å¿«æ·é”®**ï¼šæ”¯æŒé”®ç›˜å¿«æ·é”®ï¼ˆ`Ctrl+F` æœç´¢ã€`Ctrl+E` å±•å¼€å…¨éƒ¨ç­‰ï¼‰
5. **ç»Ÿè®¡ä¿¡æ¯**ï¼šæ˜¾ç¤ºæ€»è¡Œæ•°ã€è¿‡æ»¤åè¡Œæ•°ã€JSON ç»“æ„ç»Ÿè®¡
6. **Diff æ¨¡å¼**ï¼šå¯¹æ¯”ä¸¤ä¸ª JSONL æ–‡ä»¶çš„å·®å¼‚

---

## ä¹ã€é¢„æœŸæ•ˆæœ

å®Œæˆåçš„æ‰©å±•å°†æä¾›ï¼š
- âœ… ä¼˜é›…çš„ JSON Lines æŸ¥çœ‹ä½“éªŒ
- âœ… è‡ªåŠ¨è¯†åˆ«å¹¶ç¾åŒ–ç½‘é¡µä¸­çš„ JSONL å“åº”
- âœ… æ™ºèƒ½è§£ç å¤šå±‚åµŒå¥—çš„ JSON å­—ç¬¦ä¸²
- âœ… å¼ºå¤§çš„æœç´¢è¿‡æ»¤åŠŸèƒ½ï¼ˆæ”¯æŒè§£ç åå†…å®¹æœç´¢ï¼‰
- âœ… è½»é‡çº§ï¼ˆ< 500KBï¼‰ã€å¿«é€Ÿå“åº”
- âœ… æ”¯æŒäº®/æš—ä¸¤ç§ä¸»é¢˜

ç”¨æˆ·å¯ä»¥åƒä½¿ç”¨ JSONView ä¸€æ ·è‡ªç„¶åœ°æŸ¥çœ‹ JSONL æ•°æ®ï¼Œæ— éœ€å¤åˆ¶åˆ°å¤–éƒ¨å·¥å…·è¿›è¡Œè§£ç ã€‚

---

## åã€è‡ªåŠ¨è§£ç åŠŸèƒ½è®¾è®¡è§„åˆ™

### 10.1 æ ¸å¿ƒæ¦‚å¿µ

**`autoDecodeEnabled`** æ˜¯ä¸€ä¸ªå…¨å±€UIåå¥½è®¾ç½®ï¼Œæ§åˆ¶JSONå†…å®¹çš„é»˜è®¤æ¸²æŸ“æ–¹å¼å’Œæœç´¢è¡Œä¸ºã€‚

**è®¾è®¡åŸåˆ™ï¼šæ‰€çœ‹å³æ‰€å¾—**
- ç”¨æˆ·åœ¨ç•Œé¢ä¸Šçœ‹åˆ°ä»€ä¹ˆå†…å®¹ï¼Œæœç´¢å°±åœ¨ä»€ä¹ˆå†…å®¹ä¸­è¿›è¡Œ
- è§£ç çŠ¶æ€å½±å“æ¸²æŸ“å’Œæœç´¢ï¼Œç¡®ä¿ä¸¤è€…ä¿æŒä¸€è‡´

### 10.2 æ•°æ®ç»“æ„

```typescript
interface JsonLineNode {
  id: string                      // å”¯ä¸€æ ‡è¯†
  lineNumber: number              // åŸå§‹è¡Œå·
  rawContent: string              // åŸå§‹ JSON å­—ç¬¦ä¸²ï¼ˆæ°¸ä¸æ”¹å˜ï¼‰
  parsedData: any                 // è§£æåçš„å¯¹è±¡
  isExpanded: boolean             // å±•å¼€çŠ¶æ€
  decodedStrings: Map<string, DecodedString>  // è§£ç å­—ç¬¦ä¸²ç¼“å­˜
  decodedText: string             // è§£ç åçš„æ–‡æœ¬ç¼“å­˜ï¼ˆç”¨äºæœç´¢ï¼‰
}
```

#### `decodedText` å­—æ®µç”Ÿæˆè§„åˆ™

åœ¨è§£æJSONæ—¶ï¼ˆ`parser.ts`ï¼‰ï¼Œè°ƒç”¨ `extractDecodedText(parsedData)` ç”Ÿæˆï¼š

```typescript
/**
 * æå–å¯¹è±¡ä¸­æ‰€æœ‰è§£ç åçš„æ–‡æœ¬å€¼
 * @returns å¦‚æœå†…å®¹éœ€è¦è§£ç ï¼Œè¿”å›è§£ç åçš„æ–‡æœ¬ï¼›å¦åˆ™è¿”å›ç©ºå­—ç¬¦ä¸²
 */
export function extractDecodedText(parsedData: any): string {
  let hasDecoding = false  // æ ‡è®°æ˜¯å¦å‘ç”Ÿäº†è§£ç 

  // éå†æ‰€æœ‰å€¼ï¼Œæ£€æµ‹å¹¶æ”¶é›†éœ€è¦è§£ç çš„å†…å®¹
  // 1. æ£€æµ‹è½¬ä¹‰å­—ç¬¦ï¼ˆ\n, \t, \", \\ï¼‰
  // 2. æ£€æµ‹åµŒå¥—JSONå­—ç¬¦ä¸²ï¼ˆä»¥ { æˆ– [ å¼€å¤´ï¼‰

  // å¦‚æœæ²¡æœ‰å‘ç”Ÿä»»ä½•è§£ç 
  if (!hasDecoding) {
    return ''  // è¿”å›ç©ºå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ— éœ€è§£ç 
  }

  // å‘ç”Ÿäº†è§£ç ï¼Œè¿”å›è§£ç åçš„å®Œæ•´æ–‡æœ¬
  return texts.join(' ')
}
```

**åˆ¤æ–­æ ‡å‡†ï¼š**
- âœ… **éœ€è¦è§£ç **ï¼ˆ`decodedText` = è§£ç åæ–‡æœ¬ï¼‰ï¼š
  - åŒ…å«è½¬ä¹‰å­—ç¬¦ï¼š`\n`, `\t`, `\"`, `\\`, `\r`
  - åŒ…å«åµŒå¥—JSONå­—ç¬¦ä¸²ï¼šå€¼ä»¥ `{` æˆ– `[` å¼€å¤´ä¸”å¯æˆåŠŸè§£æ
- âŒ **æ— éœ€è§£ç **ï¼ˆ`decodedText` = `''`ï¼‰ï¼š
  - æ™®é€šå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰åŸºæœ¬ç±»å‹
  - ä¸åŒ…å«è½¬ä¹‰å­—ç¬¦æˆ–åµŒå¥—ç»“æ„

### 10.3 autoDecodeEnabled çš„ä½œç”¨

#### ä½œç”¨ 1ï¼šæ§åˆ¶UIæ¸²æŸ“

åœ¨ç»„ä»¶ä¸­æ ¹æ® `autoDecodeEnabled` å†³å®šæ˜¾ç¤ºå†…å®¹ï¼š

```typescript
// JsonTree.vue / JsonLineItem.vue
const displayValue = computed(() => {
  if (store.autoDecodeEnabled && node.decodedText) {
    // è‡ªåŠ¨è§£ç å¼€å¯ï¼Œä¸”æœ‰è§£ç å†…å®¹
    return node.decodedText
  } else {
    // è‡ªåŠ¨è§£ç å…³é—­ï¼Œæˆ–æ— è§£ç å†…å®¹
    return node.rawContent
  }
})
```

**æ¸²æŸ“è§„åˆ™ï¼š**
- âœ… **å‹¾é€‰"è‡ªåŠ¨è§£ç "**ï¼š
  - å¦‚æœ `decodedText` éç©ºï¼šæ˜¾ç¤ºè§£ç åçš„å†…å®¹
  - å¦‚æœ `decodedText` ä¸ºç©ºï¼šæ˜¾ç¤º `rawContent`ï¼ˆåŸå§‹å†…å®¹ï¼‰
- âŒ **å–æ¶ˆ"è‡ªåŠ¨è§£ç "**ï¼š
  - å§‹ç»ˆæ˜¾ç¤º `rawContent`ï¼ˆåŸå§‹JSONå­—ç¬¦ä¸²ï¼‰

**æ‰‹åŠ¨åˆ‡æ¢ï¼š**
- å³ä½¿å–æ¶ˆ"è‡ªåŠ¨è§£ç "ï¼Œç”¨æˆ·ä»å¯ç‚¹å‡»èŠ‚ç‚¹æ—è¾¹çš„è§£ç æŒ‰é’®æ‰‹åŠ¨æŸ¥çœ‹è§£ç åçš„å†…å®¹
- æ‰‹åŠ¨è§£ç ä¸å½±å“å…¨å±€ `autoDecodeEnabled` è®¾ç½®

#### ä½œç”¨ 2ï¼šæ§åˆ¶æœç´¢è¡Œä¸ºï¼ˆæ‰€çœ‹å³æ‰€å¾—ï¼‰

åœ¨æœç´¢æ—¶ï¼Œæ ¹æ® `autoDecodeEnabled` é€‰æ‹©æœç´¢çš„æ–‡æœ¬æºï¼š

```typescript
// filter.ts
function matchInLine(
  line: JsonLineNode,
  keyword: string,
  searchMode: SearchMode,
  autoDecodeEnabled: boolean
): boolean {
  // æ‰€çœ‹å³æ‰€å¾—ï¼šæ ¹æ®ç”¨æˆ·çš„æ¸²æŸ“åå¥½é€‰æ‹©æœç´¢æº
  const searchText = (autoDecodeEnabled && line.decodedText)
    ? line.decodedText     // æœç´¢è§£ç åçš„å†…å®¹
    : line.rawContent      // æœç´¢åŸå§‹å†…å®¹

  return matchString(searchText.toLowerCase(), keyword, searchMode)
}
```

**æœç´¢è§„åˆ™ï¼š**
- âœ… **å‹¾é€‰"è‡ªåŠ¨è§£ç "**ï¼š
  - å¦‚æœ `decodedText` éç©ºï¼šåœ¨è§£ç åçš„å†…å®¹ä¸­æœç´¢
  - å¦‚æœ `decodedText` ä¸ºç©ºï¼šåœ¨ `rawContent` ä¸­æœç´¢
- âŒ **å–æ¶ˆ"è‡ªåŠ¨è§£ç "**ï¼š
  - å§‹ç»ˆåœ¨ `rawContent` ä¸­æœç´¢

### 10.4 å®Œæ•´å·¥ä½œæµç¨‹

#### æµç¨‹ 1ï¼šæ–‡ä»¶åŠ è½½ä¸è§£æ

```
ç”¨æˆ·ä¸Šä¼  JSONL æ–‡ä»¶
    â†“
parser.ts è§£ææ¯ä¸€è¡Œ
    â†“
å¯¹æ¯ä¸ª JsonLineNode:
  1. è§£æ JSON â†’ parsedData
  2. è°ƒç”¨ extractDecodedText(parsedData)
     â†’ ç”Ÿæˆ decodedTextï¼ˆå¯èƒ½ä¸ºç©ºï¼‰
  3. ä¿å­˜åˆ° store
```

#### æµç¨‹ 2ï¼šUI æ¸²æŸ“

```
ç”¨æˆ·æŸ¥çœ‹ JSON åˆ—è¡¨
    â†“
ç»„ä»¶è¯»å– store.autoDecodeEnabled
    â†“
å¦‚æœ autoDecodeEnabled = true ä¸” decodedText éç©º:
  â†’ æ˜¾ç¤ºè§£ç åçš„å†…å®¹ï¼ˆæ¢è¡Œã€åµŒå¥—ç»“æ„ç­‰ï¼‰
å¦åˆ™:
  â†’ æ˜¾ç¤ºåŸå§‹ rawContentï¼ˆå¸¦è½¬ä¹‰å­—ç¬¦çš„å­—ç¬¦ä¸²ï¼‰
```

#### æµç¨‹ 3ï¼šç”¨æˆ·åˆ‡æ¢"è‡ªåŠ¨è§£ç "

```
ç”¨æˆ·ç‚¹å‡»"è‡ªåŠ¨è§£ç "å¤é€‰æ¡†
    â†“
è°ƒç”¨ store.toggleAutoDecodeEnabled()
    â†“
autoDecodeEnabled çŠ¶æ€ç¿»è½¬
    â†“
Vue å“åº”å¼ç³»ç»Ÿè§¦å‘é‡æ–°æ¸²æŸ“
    â†“
æ‰€æœ‰ç»„ä»¶æ ¹æ®æ–°çš„ autoDecodeEnabled å€¼é‡æ–°è®¡ç®— displayValue
    â†“
ç•Œé¢ç«‹å³æ›´æ–°ï¼ˆè§£ç  â†” åŸå§‹ï¼‰
```

#### æµç¨‹ 4ï¼šæœç´¢è¿‡æ»¤

```
ç”¨æˆ·è¾“å…¥æœç´¢å…³é”®å­—
    â†“
filter.ts æ‰§è¡Œæœç´¢
    â†“
å¯¹æ¯ä¸ª JsonLineNode:
  1. è¯»å– autoDecodeEnabled çŠ¶æ€
  2. é€‰æ‹©æœç´¢æº:
     - autoDecodeEnabled=true ä¸” decodedText éç©º â†’ åœ¨ decodedText ä¸­æœç´¢
     - å¦åˆ™ â†’ åœ¨ rawContent ä¸­æœç´¢
  3. è¿”å›åŒ¹é…ç»“æœ
    â†“
åªæ˜¾ç¤ºåŒ¹é…çš„è¡Œ/èŠ‚ç‚¹
```

### 10.5 æ€§èƒ½ä¼˜åŒ–è¦ç‚¹

1. **é¢„è®¡ç®—è§£ç **ï¼š
   - è§£ç æ“ä½œåœ¨æ–‡ä»¶åŠ è½½æ—¶ä¸€æ¬¡æ€§å®Œæˆ
   - æœç´¢æ—¶æ— éœ€é‡æ–°è§£ç ï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜çš„ `decodedText`

2. **å†…å­˜ä¼˜åŒ–**ï¼š
   - å¦‚æœä¸éœ€è¦è§£ç ï¼ˆçº¦70%çš„æ•°æ®ï¼‰ï¼Œ`decodedText` ä¸ºç©ºå­—ç¬¦ä¸²
   - é¿å…é‡å¤å­˜å‚¨ç›¸åŒå†…å®¹

3. **å“åº”å¼æ¸²æŸ“**ï¼š
   - Vue çš„å“åº”å¼ç³»ç»Ÿç¡®ä¿ `autoDecodeEnabled` å˜åŒ–æ—¶ç«‹å³é‡æ–°æ¸²æŸ“
   - æ— éœ€æ‰‹åŠ¨åˆ·æ–°æˆ–é‡æ–°è§£ææ•°æ®

### 10.6 ç”¨æˆ·ä½“éªŒ

**åœºæ™¯ Aï¼šæŸ¥çœ‹å¤æ‚åµŒå¥—æ•°æ®**
```jsonl
{"id": 1, "data": "{\"user\":\"Alice\",\"msg\":\"Line1\\nLine2\"}"}
```

1. **å‹¾é€‰"è‡ªåŠ¨è§£ç "**ï¼š
   ```
   id: 1
   data:
     user: "Alice"
     msg: "Line1
           Line2"
   ```
   æœç´¢ "Alice" â†’ âœ… æ‰¾åˆ°ï¼ˆåœ¨è§£ç å†…å®¹ä¸­ï¼‰

2. **å–æ¶ˆ"è‡ªåŠ¨è§£ç "**ï¼š
   ```
   id: 1
   data: "{\"user\":\"Alice\",\"msg\":\"Line1\\nLine2\"}"
   ```
   æœç´¢ "Alice" â†’ âŒ æ‰¾ä¸åˆ°ï¼ˆåœ¨åŸå§‹å­—ç¬¦ä¸²ä¸­æœç´¢éœ€è¦æœ `\"Alice\"`ï¼‰
   æœç´¢ "\\nLine2" â†’ âœ… æ‰¾åˆ°ï¼ˆæœç´¢è½¬ä¹‰åºåˆ—ï¼‰

**åœºæ™¯ Bï¼šæ™®é€šæ•°æ®ï¼ˆæ— éœ€è§£ç ï¼‰**
```jsonl
{"id": 2, "name": "Bob", "age": 30}
```

- `decodedText` = `''`ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰
- æ— è®ºæ˜¯å¦å‹¾é€‰"è‡ªåŠ¨è§£ç "ï¼Œæ˜¾ç¤ºå’Œæœç´¢è¡Œä¸ºä¸€è‡´
- æœç´¢ "Bob" â†’ âœ… å§‹ç»ˆèƒ½æ‰¾åˆ°

### 10.7 å®ç°æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | èŒè´£ | å…³é”®å‡½æ•°/å˜é‡ |
|------|------|--------------|
| `types.ts` | å®šä¹‰æ•°æ®ç»“æ„ | `JsonLineNode.decodedText`<br>`SearchOptions.autoDecodeEnabled` |
| `decoder.ts` | è§£ç é€»è¾‘ | `extractDecodedText()` |
| `parser.ts` | è§£ææ—¶ç”Ÿæˆç¼“å­˜ | è°ƒç”¨ `extractDecodedText()` |
| `filter.ts` | æœç´¢é€»è¾‘ | `matchInLine()`<br>`filterNodes()` |
| `jsonlStore.ts` | çŠ¶æ€ç®¡ç† | `autoDecodeEnabled`<br>`toggleAutoDecodeEnabled()` |
| `SearchFilter.vue` | UIæ§ä»¶ | å¤é€‰æ¡†ç»‘å®š `autoDecodeEnabled` |
| `JsonTree.vue`<br>`JsonLineItem.vue` | æ¸²æŸ“ç»„ä»¶ | æ ¹æ® `autoDecodeEnabled` é€‰æ‹©æ˜¾ç¤ºå†…å®¹ |

### 10.8 æµ‹è¯•ç”¨ä¾‹

#### æµ‹è¯• 1ï¼šdecodedText ç”Ÿæˆæ­£ç¡®æ€§
```typescript
// è¾“å…¥
const input1 = { msg: "Hello\\nWorld" }
// æœŸæœ›ï¼šdecodedText = "Hello\nWorld"ï¼ˆåŒ…å«å®é™…æ¢è¡Œï¼‰

const input2 = { data: "{\"key\":\"value\"}" }
// æœŸæœ›ï¼šdecodedText åŒ…å«è§£æåçš„åµŒå¥—å†…å®¹

const input3 = { name: "Alice", age: 30 }
// æœŸæœ›ï¼šdecodedText = ''ï¼ˆæ— éœ€è§£ç ï¼‰
```

#### æµ‹è¯• 2ï¼šæ¸²æŸ“åˆ‡æ¢
```typescript
// 1. å‹¾é€‰"è‡ªåŠ¨è§£ç "
store.autoDecodeEnabled = true
// æœŸæœ›ï¼šæ˜¾ç¤ºè§£ç åå†…å®¹ï¼ˆå¦‚æœæœ‰ï¼‰

// 2. å–æ¶ˆ"è‡ªåŠ¨è§£ç "
store.autoDecodeEnabled = false
// æœŸæœ›ï¼šæ˜¾ç¤ºåŸå§‹ rawContent
```

#### æµ‹è¯• 3ï¼šæœç´¢è¡Œä¸ºä¸€è‡´æ€§
```jsonl
{"id": 2, "data": "{\"secret\":\"password\"}"}
```

```typescript
// åœºæ™¯Aï¼šå‹¾é€‰"è‡ªåŠ¨è§£ç "
store.autoDecodeEnabled = true
search("secret")  // âœ… åº”è¯¥æ‰¾åˆ°ï¼ˆåœ¨è§£ç å†…å®¹ä¸­ï¼‰
search("\\\"secret\\\"")  // âŒ æ‰¾ä¸åˆ°ï¼ˆä¸æœåŸå§‹è½¬ä¹‰ï¼‰

// åœºæ™¯Bï¼šå–æ¶ˆ"è‡ªåŠ¨è§£ç "
store.autoDecodeEnabled = false
search("secret")  // âŒ æ‰¾ä¸åˆ°ï¼ˆåœ¨åŸå§‹å­—ç¬¦ä¸²ä¸­ï¼‰
search("\\\"secret\\\"")  // âœ… åº”è¯¥æ‰¾åˆ°ï¼ˆæœè½¬ä¹‰åºåˆ—ï¼‰
```

---
