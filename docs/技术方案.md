# JSONL Viewer Chrome æ‰©å±• - å®æ–½æ–¹æ¡ˆ

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### æ ¸å¿ƒåŠŸèƒ½
1. å±•å¼€/æŠ˜å  JSON Lines å’Œ JSON å±‚æ¬¡ç»“æ„
2. æ™ºèƒ½é€’å½’è§£ç å¤æ‚å­—ç¬¦ä¸²ï¼ˆ`\n`ã€`\"`ç­‰è½¬ä¹‰å­—ç¬¦ï¼‰
3. æ”¯æŒæŸ¥æ‰¾è¿‡æ»¤ï¼ˆåŸå§‹å†…å®¹ + è§£ç åå†…å®¹ï¼‰
4. ä¸¤ç§è¿‡æ»¤æ¨¡å¼ï¼šæŒ‰è¡Œè¿‡æ»¤ / æŒ‰å¶å­èŠ‚ç‚¹è¿‡æ»¤

### ä½¿ç”¨åœºæ™¯
- **åœºæ™¯ A**ï¼šæ‰“å¼€æœ¬åœ° `.jsonl` æ–‡ä»¶æŸ¥çœ‹
- **åœºæ™¯ B**ï¼šè‡ªåŠ¨ç¾åŒ–ç½‘é¡µä¸­çš„ JSONL API å“åº”ï¼ˆç±»ä¼¼ JSONViewï¼‰

---

## äºŒã€æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ
- **æ¡†æ¶**ï¼šVue 3 + TypeScript
- **æ„å»ºå·¥å…·**ï¼šVite
- **UI ç»„ä»¶åº“**ï¼šæ— ï¼ˆä½¿ç”¨åŸç”Ÿ CSSï¼Œä¿æŒè½»é‡ï¼‰
- **çŠ¶æ€ç®¡ç†**ï¼šPiniaï¼ˆè½»é‡çº§ï¼‰
- **è™šæ‹Ÿåˆ—è¡¨**ï¼švue-virtual-scrollerï¼ˆå¯é€‰ï¼Œå¦‚éœ€åç»­æ”¯æŒå¤§æ–‡ä»¶ï¼‰

### Chrome æ‰©å±•æ¶æ„

```
chrome-extension/
â”œâ”€â”€ manifest.json              # V3 æ¸…å•æ–‡ä»¶
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ content/               # å†…å®¹è„šæœ¬ï¼ˆæ‹¦æˆªç½‘é¡µ JSONLï¼‰
â”‚   â”‚   â””â”€â”€ content.ts
â”‚   â”œâ”€â”€ viewer/                # æŸ¥çœ‹å™¨ä¸»ç•Œé¢
â”‚   â”‚   â”œâ”€â”€ App.vue
â”‚   â”‚   â”œâ”€â”€ main.ts
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ JsonLineItem.vue      # å•è¡Œ JSON ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ JsonTree.vue          # JSON æ ‘å½¢ç»“æ„
â”‚   â”‚   â”‚   â”œâ”€â”€ StringDecoder.vue     # å­—ç¬¦ä¸²è§£ç å™¨
â”‚   â”‚   â”‚   â””â”€â”€ SearchFilter.vue      # æœç´¢è¿‡æ»¤å™¨
â”‚   â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”‚   â””â”€â”€ jsonlStore.ts         # æ•°æ®çŠ¶æ€ç®¡ç†
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â”œâ”€â”€ decoder.ts            # é€’å½’è§£ç é€»è¾‘
â”‚   â”‚       â”œâ”€â”€ filter.ts             # è¿‡æ»¤é€»è¾‘
â”‚   â”‚       â””â”€â”€ parser.ts             # JSONL è§£æ
â”‚   â”œâ”€â”€ background/            # åå°è„šæœ¬
â”‚   â”‚   â””â”€â”€ background.ts
â”‚   â””â”€â”€ popup/                 # å¼¹å‡ºçª—å£ï¼ˆå¯é€‰ï¼‰
â”‚       â””â”€â”€ popup.vue
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ icons/                 # æ‰©å±•å›¾æ ‡
â”‚   â””â”€â”€ viewer.html            # æŸ¥çœ‹å™¨ HTML æ¨¡æ¿
â””â”€â”€ vite.config.ts
```

---

## ä¸‰ã€æ ¸å¿ƒåŠŸèƒ½è®¾è®¡

### 3.1 æ•°æ®ç»“æ„

#### JsonLineNodeï¼ˆå•è¡Œ JSONL æ•°æ®ï¼‰
```typescript
interface JsonLineNode {
  id: string                      // å”¯ä¸€æ ‡è¯†
  lineNumber: number              // åŸå§‹è¡Œå·
  rawContent: string              // åŸå§‹ JSON å­—ç¬¦ä¸²ï¼ˆæ°¸ä¸æ”¹å˜ï¼‰
  parsedData: any                 // è§£æåçš„å¯¹è±¡
  isExpanded: boolean             // å±•å¼€çŠ¶æ€
  decodedStrings: Map<string, DecodedString>  // è§£ç å­—ç¬¦ä¸²ç¼“å­˜
  decodedText: string             // è§£ç åçš„æ–‡æœ¬ç¼“å­˜ï¼ˆç”¨äºæœç´¢ï¼‰
  matchedPath?: string            // JSONPath åŒ¹é…æ—¶çš„è·¯å¾„
}
```

#### JsonNodeï¼ˆJSON æ ‘èŠ‚ç‚¹ï¼‰
```typescript
interface JsonNode {
  key: string
  value: any
  type: 'object' | 'array' | 'string' | 'number' | 'boolean' | 'null'
  isExpanded: boolean
  children?: JsonNode[]
  depth: number
  isDecodable: boolean            // æ˜¯å¦ä¸ºå¯è§£ç çš„ JSON å­—ç¬¦ä¸²
  decodedValue?: any              // è§£ç åçš„å€¼
}
```

### 3.2 æ™ºèƒ½å­—ç¬¦ä¸²è§£ç 

#### æ ¸å¿ƒè®¾è®¡åŸåˆ™

**è‡ªåŠ¨è§£ç ï¼ˆautoDecodeEnabledï¼‰**ï¼š
- å…¨å±€ UI åå¥½è®¾ç½®ï¼Œæ§åˆ¶é»˜è®¤æ¸²æŸ“æ–¹å¼å’Œæœç´¢è¡Œä¸º
- **æ‰€çœ‹å³æ‰€å¾—**ï¼šç”¨æˆ·çœ‹åˆ°ä»€ä¹ˆï¼Œæœç´¢å°±åœ¨ä»€ä¹ˆå†…å®¹ä¸­è¿›è¡Œ

#### ä¸¤é˜¶æ®µè§£ç ç­–ç•¥

**é˜¶æ®µ 1ï¼šé¢„è®¡ç®—ç¼“å­˜ï¼ˆparser.tsï¼‰**
```typescript
export function extractDecodedText(parsedData: any): string {
  let hasDecoding = false  // æ ‡è®°æ˜¯å¦éœ€è¦è§£ç 
  const texts: string[] = []

  function traverse(value: any, depth: number = 0) {
    if (depth > MAX_RECURSION_DEPTH) return

    if (typeof value === 'string') {
      const hasEscape = value.includes('\\')
      const looksLikeJson = value.trim().startsWith('{') || value.trim().startsWith('[')

      if (!hasEscape && !looksLikeJson) {
        texts.push(value)  // æ™®é€šå­—ç¬¦ä¸²ï¼Œæ— éœ€è§£ç 
        return
      }

      // å¤„ç†è½¬ä¹‰å­—ç¬¦
      if (hasEscape) {
        const decoded = unescapeString(value)
        if (decoded !== value) {
          hasDecoding = true
          texts.push(decoded)
        }
      }

      // å°è¯•è§£æåµŒå¥— JSON
      if (looksLikeJson && value.length < 100000) {
        try {
          const nested = JSON.parse(value)
          hasDecoding = true
          traverse(nested, depth + 1)
        } catch {}
      }
    } else if (typeof value === 'object') {
      // é€’å½’éå†å¯¹è±¡/æ•°ç»„
      if (Array.isArray(value)) {
        value.forEach(item => traverse(item, depth + 1))
      } else {
        for (const key in value) {
          traverse(value[key], depth + 1)
        }
      }
    } else {
      texts.push(String(value))
    }
  }

  traverse(parsedData)

  // å…³é”®ä¼˜åŒ–ï¼šå¦‚æœä¸éœ€è¦è§£ç ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²
  if (!hasDecoding) {
    return ''  // èŠ‚çœå†…å­˜ï¼Œä¸é‡å¤å­˜å‚¨
  }

  return texts.join(' ')
}
```

**é˜¶æ®µ 2ï¼šæŒ‰éœ€æ¸²æŸ“ï¼ˆStringDecoder.vueï¼‰**
```typescript
export function smartDecode(value: any, depth: number = 0): DecodedResult {
  if (depth > MAX_RECURSION_DEPTH || typeof value !== 'string') {
    return { type: 'primitive', value }
  }

  // æ£€æµ‹æ˜¯å¦ä¸º JSON å­—ç¬¦ä¸²
  if (isJsonString(value)) {
    try {
      const parsed = JSON.parse(value)
      return {
        type: 'json',
        original: value,
        decoded: smartDecode(parsed, depth + 1),
        displayMode: 'decoded'
      }
    } catch {
      return { type: 'string', value, displayValue: unescapeString(value) }
    }
  }

  // å¤„ç†åŒ…å«å®é™…æ¢è¡Œç¬¦ç­‰ç‰¹æ®Šå­—ç¬¦çš„å­—ç¬¦ä¸²
  if (value.includes('\n') || value.includes('\t') || value.includes('\r')) {
    const formatted = formatXmlIfNeeded(value)  // XML/HTML æ ¼å¼åŒ–
    return { type: 'string', value, displayValue: formatted }
  }

  // å¤„ç†è½¬ä¹‰å­—ç¬¦ä¸²
  const unescaped = unescapeString(value)
  if (unescaped !== value) {
    return { type: 'string', value, displayValue: unescaped }
  }

  return { type: 'string', value }
}
```

#### æ˜¾ç¤ºæ¨¡å¼æ§åˆ¶

**å…¨å±€æ§åˆ¶**ï¼š
- ç”¨æˆ·åˆ‡æ¢ `autoDecodeEnabled`ï¼Œæ‰€æœ‰èŠ‚ç‚¹ç«‹å³åˆ·æ–°
- ç›‘å¬å…¨å±€è®¾ç½®å˜åŒ–ï¼Œå¼ºåˆ¶æ›´æ–°æ‰€æœ‰ç»„ä»¶ï¼š
  ```typescript
  watch(() => store.autoDecodeEnabled, (newValue) => {
    displayMode.value = newValue ? 'decoded' : 'original'
  })
  ```

**èŠ‚ç‚¹çº§ä¸´æ—¶åˆ‡æ¢**ï¼š
- ç”¨æˆ·ç‚¹å‡»å•ä¸ªèŠ‚ç‚¹çš„åˆ‡æ¢æŒ‰é’®ï¼Œä¸´æ—¶è¦†ç›–å…¨å±€è®¾ç½®
- ä¸‹æ¬¡å…¨å±€è®¾ç½®å˜åŒ–æ—¶ï¼Œè¢«å¼ºåˆ¶åˆ·æ–°

### 3.3 é«˜çº§è¿‡æ»¤åŠŸèƒ½

#### ä¸‰ç§æœç´¢æ¨¡å¼

**1. æ¨¡ç³ŠåŒ¹é…ï¼ˆFuzzyï¼‰**
```typescript
function matchString(text: string, keyword: string, searchMode: 'fuzzy'): boolean {
  return text.includes(keyword)  // ç®€å•åŒ…å«å³å¯
}
```

**2. å®Œæ•´åŒ¹é…ï¼ˆExactï¼‰**
```typescript
function matchString(text: string, keyword: string, searchMode: 'exact'): boolean {
  const regex = new RegExp(`\\b${escapeRegex(keyword)}\\b`, 'i')
  return regex.test(text)  // å®Œæ•´å•è¯è¾¹ç•ŒåŒ¹é…
}
```

**3. JSONPath æŸ¥è¯¢**
```typescript
function evaluateJsonPath(obj: any, path: string): any {
  // æ”¯æŒè¯­æ³•ï¼š
  // $.user.name              # ç‚¹å·è®¿é—®
  // $.data[0]                # æ•°ç»„ç´¢å¼•
  // $.items[*]               # æ•°ç»„é€šé…ç¬¦
  // $..content               # é€’å½’ä¸‹é™

  if (path.includes('..')) {
    return evaluateRecursivePath(obj, path)  // é€’å½’æŸ¥æ‰¾
  }

  // æ™®é€šè·¯å¾„è§£æ
  const parts = path.substring(1).split(/\.|\\[/).map(p => p.replace(/\\]$/, ''))
  let current = obj
  for (const part of parts) {
    if (part === '*') {
      return Array.isArray(current) ? current : null
    }
    if (/^\d+$/.test(part)) {
      current = current[parseInt(part)]
    } else {
      current = current[part]
    }
    if (current === undefined) return null
  }
  return current
}
```

#### ä¸¤ç§è¿‡æ»¤èŒƒå›´

**1. æŒ‰è¡Œè¿‡æ»¤ï¼ˆLine Modeï¼‰**
```typescript
function filterByLine(
  lines: JsonLineNode[],
  keyword: string,
  searchMode: SearchMode,
  autoDecodeEnabled: boolean
): JsonLineNode[] {
  return lines.filter(line => {
    // æ‰€çœ‹å³æ‰€å¾—ï¼šæ ¹æ®è‡ªåŠ¨è§£ç è®¾ç½®é€‰æ‹©æœç´¢æº
    const searchText = (autoDecodeEnabled && line.decodedText)
      ? line.decodedText
      : line.rawContent

    return matchString(searchText.toLowerCase(), keyword, searchMode)
  })
}
```

**2. æŒ‰èŠ‚ç‚¹è¿‡æ»¤ï¼ˆNode Modeï¼‰**
```typescript
function filterByNode(
  lines: JsonLineNode[],
  keyword: string,
  searchMode: SearchMode,
  autoDecodeEnabled: boolean
): JsonLineNode[] {
  return lines.map(line => {
    const filteredData = filterNodes(line.parsedData, keyword, searchMode, autoDecodeEnabled)
    if (filteredData === null) return null

    return { ...line, parsedData: filteredData }
  }).filter(line => line !== null)
}

function filterNodes(node: any, keyword: string, ...): any {
  // é€’å½’è¿‡æ»¤ï¼Œåªä¿ç•™åŒ¹é…çš„å¶å­èŠ‚ç‚¹åŠå…¶è·¯å¾„
  if (typeof node !== 'object') {
    // å¶å­èŠ‚ç‚¹ï¼šæ£€æŸ¥æ˜¯å¦åŒ¹é…
    return searchInObject(node, keyword, ...) ? node : null
  }

  if (Array.isArray(node)) {
    const filtered = node.map(item => filterNodes(item, ...)).filter(item => item !== null)
    return filtered.length > 0 ? filtered : null
  }

  const result: any = {}
  let hasMatch = false
  for (const key in node) {
    if (matchString(key.toLowerCase(), keyword, ...)) {
      result[key] = node[key]  // é”®ååŒ¹é…
      hasMatch = true
    } else {
      const filtered = filterNodes(node[key], ...)
      if (filtered !== null) {
        result[key] = filtered
        hasMatch = true
      }
    }
  }
  return hasMatch ? result : null
}
```

### 3.4 æœ¬åœ°æ–‡ä»¶è¯»å–

#### å¢é‡è§£æç­–ç•¥ï¼ˆ100MB+ å¤§æ–‡ä»¶ä¼˜åŒ–ï¼‰

**æ ¸å¿ƒæ€è·¯**ï¼šé¦–å±å¿«é€Ÿæ˜¾ç¤ºï¼Œåå°å¼‚æ­¥è§£æ

```typescript
// parser.ts
export function parseJsonLinesIncremental(
  text: string,
  initialBatchSize: number = 100,
  onProgress?: (lines: JsonLineNode[], isComplete: boolean) => void
): JsonLineNode[] {
  const allLines = text.split('\n').filter(line => line.trim())
  const result: JsonLineNode[] = []

  // ç¬¬1æ­¥ï¼šç«‹å³è§£æé¦–æ‰¹100è¡Œ
  for (let i = 0; i < Math.min(initialBatchSize, allLines.length); i++) {
    const parsedData = JSON.parse(allLines[i])
    result.push({
      id: `line-${i}`,
      lineNumber: i + 1,
      rawContent: allLines[i],
      parsedData,
      isExpanded: false,
      decodedStrings: new Map(),
      decodedText: extractDecodedText(parsedData)
    })
  }

  // ç¬¬2æ­¥ï¼šå›è°ƒé¦–æ‰¹æ•°æ®ï¼Œç«‹å³æ˜¾ç¤º
  if (onProgress) {
    onProgress([...result], allLines.length <= initialBatchSize)
  }

  // ç¬¬3æ­¥ï¼šåå°è§£æå‰©ä½™è¡Œï¼ˆæ¯æ‰¹500è¡Œï¼‰
  if (allLines.length > initialBatchSize) {
    const parseRemaining = (startIndex: number) => {
      const batchSize = 500
      const endIndex = Math.min(startIndex + batchSize, allLines.length)

      for (let i = startIndex; i < endIndex; i++) {
        const parsedData = JSON.parse(allLines[i])
        result.push({
          id: `line-${i}`,
          lineNumber: i + 1,
          rawContent: allLines[i],
          parsedData,
          isExpanded: false,
          decodedStrings: new Map(),
          decodedText: extractDecodedText(parsedData)
        })
      }

      // é€šçŸ¥è¿›åº¦æ›´æ–°
      if (onProgress) {
        const isComplete = endIndex >= allLines.length
        onProgress([...result], isComplete)
      }

      // ç»§ç»­è§£æä¸‹ä¸€æ‰¹
      if (endIndex < allLines.length) {
        if (typeof requestIdleCallback !== 'undefined') {
          requestIdleCallback(() => parseRemaining(endIndex))
        } else {
          setTimeout(() => parseRemaining(endIndex), 0)
        }
      }
    }

    // å¯åŠ¨åå°è§£æ
    if (typeof requestIdleCallback !== 'undefined') {
      requestIdleCallback(() => parseRemaining(initialBatchSize))
    } else {
      setTimeout(() => parseRemaining(initialBatchSize), 0)
    }
  }

  return result
}
```

**æ€§èƒ½ä¼˜åŒ–ç‚¹**ï¼š
1. **é¦–æ‰¹ç«‹å³æ˜¾ç¤º**ï¼š100 è¡Œåœ¨ 50ms å†…å®Œæˆï¼Œç”¨æˆ·æ— æ„ŸçŸ¥
2. **requestIdleCallback**ï¼šåˆ©ç”¨æµè§ˆå™¨ç©ºé—²æ—¶é—´è§£æ
3. **æ‰¹é‡å¤„ç†**ï¼šæ¯æ‰¹ 500 è¡Œï¼Œé¿å…é•¿æ—¶é—´é˜»å¡
4. **å¢é‡æ¸²æŸ“**ï¼šæ¯æ‰¹å®Œæˆåç«‹å³æ›´æ–° UI

#### æ–‡ä»¶ä¸Šä¼ ï¼ˆæ‹–æ”¾æ”¯æŒï¼‰

```typescript
// App.vue
const handleFileDrop = async (event: DragEvent) => {
  event.preventDefault()
  const files = event.dataTransfer?.files
  if (!files || files.length === 0) return

  const file = files[0]
  await loadFileContent(file)
}

const handleFileUpload = async (event: Event) => {
  const input = event.target as HTMLInputElement
  if (!input.files || input.files.length === 0) return

  const file = input.files[0]
  await loadFileContent(file)
}

const loadFileContent = async (file: File) => {
  const text = await file.text()

  // è‡ªåŠ¨æ£€æµ‹å¹¶å¢é‡è§£æ
  const { type, data } = parseTextIncremental(text, (lines, isComplete) => {
    // è¿›åº¦å›è°ƒï¼šå®æ—¶æ›´æ–°ç•Œé¢
    store.updateLines(lines)
    if (isComplete) {
      console.log('æ–‡ä»¶è§£æå®Œæˆ')
    }
  })

  if (type === 'invalid') {
    alert('æ— æ•ˆçš„ JSONL/JSON æ–‡ä»¶')
  }
}
```

### 3.5 ç½‘é¡µ JSONL æ‹¦æˆª

#### æå‰æ‹¦æˆªä¼˜åŒ–ï¼ˆå‡å°‘ DOM æ„å»ºæ—¶é—´ï¼‰

**é—®é¢˜**ï¼šç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½åå†æ›¿æ¢ï¼Œä¼šæµªè´¹å¤§é‡æ—¶é—´æ„å»º DOM

**è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨æ–‡æ¡£å¼€å§‹é˜¶æ®µæå‰æ£€æµ‹å¹¶æ‹¦æˆª

```typescript
// content.ts
(function() {
  // å…³é”®ï¼šåœ¨ document_start é˜¶æ®µè¿è¡Œï¼Œé¿å… DOM æ„å»º

  // å¿«é€Ÿæ£€æµ‹ JSONL æ ¼å¼ï¼ˆä»…æ£€æŸ¥å‰å‡ è¡Œï¼‰
  function fastDetectJsonl(): boolean {
    // ç­‰å¾… <pre> æ ‡ç­¾å‡ºç°ï¼ˆChrome æ¸²æŸ“ JSON çš„é»˜è®¤è¡Œä¸ºï¼‰
    const observer = new MutationObserver((mutations, obs) => {
      const pre = document.querySelector('pre')
      if (!pre) return

      const text = pre.textContent || ''
      const lines = text.split('\n').slice(0, 10)  // ä»…æ£€æŸ¥å‰10è¡Œ

      // å¿«é€Ÿåˆ¤æ–­ï¼šæ˜¯å¦ä¸º JSONL
      let validCount = 0
      for (const line of lines) {
        if (!line.trim()) continue
        try {
          JSON.parse(line)
          validCount++
        } catch {
          return false  // æœ‰ä¸€è¡Œå¤±è´¥ï¼Œä¸æ˜¯ JSONL
        }
      }

      if (validCount >= 2 && lines.length >= 2) {
        // ç¡®è®¤æ˜¯ JSONLï¼Œç«‹å³æ‹¦æˆª
        obs.disconnect()
        interceptAndReplace(text)
        return true
      }
    })

    observer.observe(document.documentElement, {
      childList: true,
      subtree: true
    })
  }

  function interceptAndReplace(bodyText: string) {
    // åœæ­¢æ–‡æ¡£è§£æ
    document.open()
    document.write(`
      <!DOCTYPE html>
      <html>
        <head>
          <meta charset="utf-8">
          <title>JSONL Viewer</title>
        </head>
        <body>
          <div id="app"></div>
          <script>
            // ä¼ é€’æ•°æ®åˆ°æŸ¥çœ‹å™¨
            window.__JSONL_DATA__ = ${JSON.stringify(bodyText)};
          </script>
          <script src="${chrome.runtime.getURL('viewer.js')}"></script>
        </body>
      </html>
    `)
    document.close()
  }

  // ä»…åœ¨å¯èƒ½çš„ JSON å“åº”é¡µé¢è¿è¡Œ
  if (document.contentType === 'application/json' ||
      document.contentType === 'text/plain' ||
      document.contentType === 'application/x-ndjson') {
    fastDetectJsonl()
  }
})()
```

**æ€§èƒ½å¯¹æ¯”**ï¼š
- **æ—§æ–¹æ¡ˆ**ï¼ˆdocument_endï¼‰ï¼šç­‰å¾…å®Œæ•´ DOM æ„å»ºï¼Œ100MB æ–‡ä»¶éœ€è¦ 5-10 ç§’
- **æ–°æ–¹æ¡ˆ**ï¼ˆdocument_start + æå‰æ‹¦æˆªï¼‰ï¼šæ‹¦æˆª DOM æ„å»ºï¼Œç›´æ¥æ¸²æŸ“æŸ¥çœ‹å™¨ï¼ŒèŠ‚çœ 80%+ æ—¶é—´

### 3.6 Manifest é…ç½®

```json
// public/manifest.json
{
  "manifest_version": 3,
  "name": "JSONL Viewer",
  "version": "1.0.0",
  "description": "æ™ºèƒ½ JSONL æŸ¥çœ‹å™¨ï¼Œæ”¯æŒå­—ç¬¦ä¸²è§£ç å’Œé«˜çº§è¿‡æ»¤",
  "permissions": ["storage"],
  "content_scripts": [{
    "matches": ["<all_urls>"],
    "js": ["content.js"],
    "run_at": "document_end"
  }],
  "web_accessible_resources": [{
    "resources": ["viewer.html"],
    "matches": ["<all_urls>"]
  }]
}
```

---

## å››ã€UI/UX è®¾è®¡

### è§†è§‰é£æ ¼
- **ä¸»é¢˜**ï¼šæ”¯æŒäº®è‰²/æš—è‰²ä¸»é¢˜åˆ‡æ¢
- **é…è‰²**ï¼šå‚è€ƒ VSCode JSON è¯­æ³•é«˜äº®
  - å¯¹è±¡é”®ï¼šæ·¡è“è‰² `#9CDCFE`
  - å­—ç¬¦ä¸²ï¼šæ©™è‰² `#CE9178`
  - æ•°å­—ï¼šç»¿è‰² `#B5CEA8`
  - å¸ƒå°”å€¼ï¼šç´«è‰² `#569CD6`
  - è§£ç æ ‡è®°ï¼šé»„è‰²èƒŒæ™¯ `#FFF3CD`

### äº¤äº’è®¾è®¡
1. **è¡Œå·åŒºåŸŸ**ï¼šæ˜¾ç¤ºåŸå§‹è¡Œå·ï¼Œå¯ç‚¹å‡»æŠ˜å 
2. **JSON æ ‘åŒºåŸŸ**ï¼šä½¿ç”¨ç¼©è¿›æ˜¾ç¤ºå±‚çº§å…³ç³»
3. **å·¥å…·æ **ï¼š
   - æœç´¢æ¡†
   - è¿‡æ»¤æ¨¡å¼åˆ‡æ¢
   - ä¸»é¢˜åˆ‡æ¢
   - å…¨éƒ¨å±•å¼€/æŠ˜å æŒ‰é’®
   - å¯¼å‡ºåŠŸèƒ½ï¼ˆå¯¼å‡ºè¿‡æ»¤åçš„æ•°æ®ï¼‰

### ç¤ºä¾‹ç•Œé¢

```
â”Œâ”€ JSONL Viewer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ğŸ“‚ æ‰“å¼€æ–‡ä»¶] [ğŸ” æœç´¢] [âš™ï¸ è®¾ç½®] [ğŸŒ™ ä¸»é¢˜]          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœç´¢: [____________] â—‹è¡Œæ¨¡å¼ â—èŠ‚ç‚¹æ¨¡å¼ â˜‘è§£ç å†…å®¹   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1  â–¼ { type: "file-history-snapshot", ...           â”‚
â”‚       â”œâ”€ type: "file-history-snapshot"               â”‚
â”‚       â”œâ”€ messageId: "0050ba14-338f-..."             â”‚
â”‚       â””â”€ snapshot: â–¶ {...}                           â”‚
â”‚                                                       â”‚
â”‚ 2  â–¼ { parentUuid: null, ...                        â”‚
â”‚       â”œâ”€ message: â–¼                                  â”‚
â”‚       â”‚   â”œâ”€ role: "user"                            â”‚
â”‚       â”‚   â””â”€ content: "Caveat: The messages..."     â”‚
â”‚       â”‚       [ğŸ”„ æ˜¾ç¤ºè§£ç å†…å®¹]                      â”‚
â”‚       â””â”€ ...                                         â”‚
â”‚                                                       â”‚
â”‚ 3  â–¶ { parentUuid: "6d5b038a...", ...               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
å…± 1024 è¡Œï¼Œæ˜¾ç¤º 3 è¡Œï¼ˆè¿‡æ»¤åï¼‰
```

---

## äº”ã€å®æ–½æ­¥éª¤

### Phase 1: é¡¹ç›®æ­å»ºï¼ˆ1 å¤©ï¼‰
- [x] åˆå§‹åŒ– Vite + Vue 3 + TypeScript é¡¹ç›®
- [x] é…ç½® Chrome æ‰©å±•å¼€å‘ç¯å¢ƒ
- [x] åˆ›å»ºåŸºç¡€ç›®å½•ç»“æ„
- [x] è®¾ç½® ESLint + Prettier

### Phase 2: æ ¸å¿ƒç»„ä»¶å¼€å‘ï¼ˆ3 å¤©ï¼‰
- [ ] `JsonLineItem.vue` - å•è¡Œ JSON æ˜¾ç¤ºç»„ä»¶
- [ ] `JsonTree.vue` - é€’å½’æ ‘å½¢ç»“æ„ç»„ä»¶
- [ ] `StringDecoder.vue` - å­—ç¬¦ä¸²è§£ç ç»„ä»¶
- [ ] å®ç°æ™ºèƒ½è§£ç ç®—æ³• `decoder.ts`

### Phase 3: è¿‡æ»¤åŠŸèƒ½ï¼ˆ2 å¤©ï¼‰
- [ ] `SearchFilter.vue` - æœç´¢è¿‡æ»¤ UI
- [ ] `filter.ts` - å®ç°ä¸¤ç§è¿‡æ»¤æ¨¡å¼
- [ ] é›†æˆè§£ç å†…å®¹æœç´¢

### Phase 4: Chrome æ‰©å±•é›†æˆï¼ˆ2 å¤©ï¼‰
- [ ] Content Script - æ‹¦æˆªç½‘é¡µ JSONL
- [ ] æœ¬åœ°æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
- [ ] Manifest V3 é…ç½®

### Phase 5: UI/UX ä¼˜åŒ–ï¼ˆ1 å¤©ï¼‰
- [ ] ä¸»é¢˜åˆ‡æ¢
- [ ] è¯­æ³•é«˜äº®
- [ ] å“åº”å¼å¸ƒå±€
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆè™šæ‹Ÿæ»šåŠ¨å¯é€‰ï¼‰

### Phase 6: æµ‹è¯•ä¸å‘å¸ƒï¼ˆ1 å¤©ï¼‰
- [ ] åŠŸèƒ½æµ‹è¯•
- [ ] ä¸åŒ JSONL æ ¼å¼å…¼å®¹æ€§æµ‹è¯•
- [ ] æ‰“åŒ…å¹¶å‘å¸ƒåˆ° Chrome Web Store

---

## å…­ã€å…³é”®æŠ€æœ¯éš¾ç‚¹

### 6.1 é€’å½’è§£ç æ€§èƒ½
**é—®é¢˜**ï¼šæ·±å±‚åµŒå¥—çš„ JSON å­—ç¬¦ä¸²é€’å½’è§£æå¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨ç¼“å­˜æœºåˆ¶ï¼Œé¿å…é‡å¤è§£æ
- é™åˆ¶æœ€å¤§é€’å½’æ·±åº¦ï¼ˆé»˜è®¤ 10 å±‚ï¼‰
- æ‡’åŠ è½½ï¼šä»…åœ¨ç”¨æˆ·å±•å¼€èŠ‚ç‚¹æ—¶æ‰è§£æå­èŠ‚ç‚¹

### 6.2 å¤§æ–‡ä»¶å¤„ç†ï¼ˆæœªæ¥æ‰©å±•ï¼‰
è™½ç„¶å½“å‰ä¸éœ€è¦ï¼Œä½†é¢„ç•™æ‰©å±•æ€§ï¼š
- ä½¿ç”¨ `vue-virtual-scroller` å®ç°è™šæ‹Ÿæ»šåŠ¨
- åˆ†é¡µåŠ è½½ï¼šæ¯æ¬¡åªåŠ è½½ 100-500 è¡Œ
- Web Worker è§£æå¤§æ–‡ä»¶

### 6.3 Content Script æ³¨å…¥
**é—®é¢˜**ï¼šContent Script éœ€è¦è®¿é—®é¡µé¢ DOM ä½†æƒé™å—é™

**è§£å†³æ–¹æ¡ˆ**ï¼š
```typescript
// ä½¿ç”¨ iframe éš”ç¦»æŸ¥çœ‹å™¨
const iframe = document.createElement('iframe');
iframe.src = chrome.runtime.getURL('viewer.html');
iframe.style.cssText = 'position:fixed; top:0; left:0; width:100%; height:100%; border:none; z-index:999999;';
document.body.innerHTML = '';
document.body.appendChild(iframe);

// é€šè¿‡ postMessage ä¼ é€’æ•°æ®
iframe.onload = () => {
  iframe.contentWindow?.postMessage({
    type: 'LOAD_JSONL',
    data: bodyText
  }, '*');
};
```

---

## ä¸ƒã€å…³é”®æ–‡ä»¶è¯´æ˜

### æ ¸å¿ƒæ–‡ä»¶
1. **`manifest.json`** - Chrome æ‰©å±•é…ç½®æ–‡ä»¶
2. **`src/viewer/App.vue`** - ä¸»åº”ç”¨å…¥å£
3. **`src/utils/decoder.ts`** - æ™ºèƒ½è§£ç æ ¸å¿ƒé€»è¾‘
4. **`src/utils/filter.ts`** - è¿‡æ»¤ç®—æ³•å®ç°
5. **`src/components/JsonTree.vue`** - é€’å½’æ ‘å½¢ç»“æ„ç»„ä»¶

### é…ç½®æ–‡ä»¶
- `vite.config.ts` - æ„å»ºé…ç½®ï¼ˆéœ€è¦é…ç½®å¤šå…¥å£ï¼‰
- `tsconfig.json` - TypeScript é…ç½®
- `package.json` - ä¾èµ–ç®¡ç†

---

## å…«ã€å¯é€‰å¢å¼ºåŠŸèƒ½

1. **å¯¼å‡ºåŠŸèƒ½**ï¼šå¯¼å‡ºè¿‡æ»¤åçš„æ•°æ®ä¸ºæ–°çš„ JSONL æ–‡ä»¶
2. **å†å²è®°å½•**ï¼šè®°å½•æœ€è¿‘æ‰“å¼€çš„æ–‡ä»¶
3. **è‡ªå®šä¹‰é…è‰²**ï¼šå…è®¸ç”¨æˆ·è‡ªå®šä¹‰è¯­æ³•é«˜äº®é¢œè‰²
4. **å¿«æ·é”®**ï¼šæ”¯æŒé”®ç›˜å¿«æ·é”®ï¼ˆ`Ctrl+F` æœç´¢ã€`Ctrl+E` å±•å¼€å…¨éƒ¨ç­‰ï¼‰
5. **ç»Ÿè®¡ä¿¡æ¯**ï¼šæ˜¾ç¤ºæ€»è¡Œæ•°ã€è¿‡æ»¤åè¡Œæ•°ã€JSON ç»“æ„ç»Ÿè®¡
6. **Diff æ¨¡å¼**ï¼šå¯¹æ¯”ä¸¤ä¸ª JSONL æ–‡ä»¶çš„å·®å¼‚

---

## ä¹ã€é¢„æœŸæ•ˆæœ

å®Œæˆåçš„æ‰©å±•å°†æä¾›ï¼š
- âœ… ä¼˜é›…çš„ JSON Lines æŸ¥çœ‹ä½“éªŒ
- âœ… è‡ªåŠ¨è¯†åˆ«å¹¶ç¾åŒ–ç½‘é¡µä¸­çš„ JSONL å“åº”
- âœ… æ™ºèƒ½è§£ç å¤šå±‚åµŒå¥—çš„ JSON å­—ç¬¦ä¸²
- âœ… å¼ºå¤§çš„æœç´¢è¿‡æ»¤åŠŸèƒ½ï¼ˆæ”¯æŒè§£ç åå†…å®¹æœç´¢ï¼‰
- âœ… è½»é‡çº§ï¼ˆ< 500KBï¼‰ã€å¿«é€Ÿå“åº”
- âœ… æ”¯æŒäº®/æš—ä¸¤ç§ä¸»é¢˜

ç”¨æˆ·å¯ä»¥åƒä½¿ç”¨ JSONView ä¸€æ ·è‡ªç„¶åœ°æŸ¥çœ‹ JSONL æ•°æ®ï¼Œæ— éœ€å¤åˆ¶åˆ°å¤–éƒ¨å·¥å…·è¿›è¡Œè§£ç ã€‚

---

## åã€è‡ªåŠ¨è§£ç åŠŸèƒ½è®¾è®¡è§„åˆ™

### 10.1 æ ¸å¿ƒæ¦‚å¿µ

**`autoDecodeEnabled`** æ˜¯ä¸€ä¸ªå…¨å±€UIåå¥½è®¾ç½®ï¼Œæ§åˆ¶JSONå†…å®¹çš„é»˜è®¤æ¸²æŸ“æ–¹å¼å’Œæœç´¢è¡Œä¸ºã€‚

**è®¾è®¡åŸåˆ™ï¼šæ‰€çœ‹å³æ‰€å¾—**
- ç”¨æˆ·åœ¨ç•Œé¢ä¸Šçœ‹åˆ°ä»€ä¹ˆå†…å®¹ï¼Œæœç´¢å°±åœ¨ä»€ä¹ˆå†…å®¹ä¸­è¿›è¡Œ
- è§£ç çŠ¶æ€å½±å“æ¸²æŸ“å’Œæœç´¢ï¼Œç¡®ä¿ä¸¤è€…ä¿æŒä¸€è‡´

### 10.2 æ•°æ®ç»“æ„

```typescript
interface JsonLineNode {
  id: string                      // å”¯ä¸€æ ‡è¯†
  lineNumber: number              // åŸå§‹è¡Œå·
  rawContent: string              // åŸå§‹ JSON å­—ç¬¦ä¸²ï¼ˆæ°¸ä¸æ”¹å˜ï¼‰
  parsedData: any                 // è§£æåçš„å¯¹è±¡
  isExpanded: boolean             // å±•å¼€çŠ¶æ€
  decodedStrings: Map<string, DecodedString>  // è§£ç å­—ç¬¦ä¸²ç¼“å­˜
  decodedText: string             // è§£ç åçš„æ–‡æœ¬ç¼“å­˜ï¼ˆç”¨äºæœç´¢ï¼‰
}
```

#### `decodedText` å­—æ®µç”Ÿæˆè§„åˆ™

åœ¨è§£æJSONæ—¶ï¼ˆ`parser.ts`ï¼‰ï¼Œè°ƒç”¨ `extractDecodedText(parsedData)` ç”Ÿæˆï¼š

```typescript
/**
 * æå–å¯¹è±¡ä¸­æ‰€æœ‰è§£ç åçš„æ–‡æœ¬å€¼
 * @returns å¦‚æœå†…å®¹éœ€è¦è§£ç ï¼Œè¿”å›è§£ç åçš„æ–‡æœ¬ï¼›å¦åˆ™è¿”å›ç©ºå­—ç¬¦ä¸²
 */
export function extractDecodedText(parsedData: any): string {
  let hasDecoding = false  // æ ‡è®°æ˜¯å¦å‘ç”Ÿäº†è§£ç 

  // éå†æ‰€æœ‰å€¼ï¼Œæ£€æµ‹å¹¶æ”¶é›†éœ€è¦è§£ç çš„å†…å®¹
  // 1. æ£€æµ‹è½¬ä¹‰å­—ç¬¦ï¼ˆ\n, \t, \", \\ï¼‰
  // 2. æ£€æµ‹åµŒå¥—JSONå­—ç¬¦ä¸²ï¼ˆä»¥ { æˆ– [ å¼€å¤´ï¼‰

  // å¦‚æœæ²¡æœ‰å‘ç”Ÿä»»ä½•è§£ç 
  if (!hasDecoding) {
    return ''  // è¿”å›ç©ºå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ— éœ€è§£ç 
  }

  // å‘ç”Ÿäº†è§£ç ï¼Œè¿”å›è§£ç åçš„å®Œæ•´æ–‡æœ¬
  return texts.join(' ')
}
```

**åˆ¤æ–­æ ‡å‡†ï¼š**
- âœ… **éœ€è¦è§£ç **ï¼ˆ`decodedText` = è§£ç åæ–‡æœ¬ï¼‰ï¼š
  - åŒ…å«è½¬ä¹‰å­—ç¬¦ï¼š`\n`, `\t`, `\"`, `\\`, `\r`
  - åŒ…å«åµŒå¥—JSONå­—ç¬¦ä¸²ï¼šå€¼ä»¥ `{` æˆ– `[` å¼€å¤´ä¸”å¯æˆåŠŸè§£æ
- âŒ **æ— éœ€è§£ç **ï¼ˆ`decodedText` = `''`ï¼‰ï¼š
  - æ™®é€šå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”å€¼ç­‰åŸºæœ¬ç±»å‹
  - ä¸åŒ…å«è½¬ä¹‰å­—ç¬¦æˆ–åµŒå¥—ç»“æ„

### 10.3 autoDecodeEnabled çš„ä½œç”¨

#### ä½œç”¨ 1ï¼šæ§åˆ¶UIæ¸²æŸ“

åœ¨ç»„ä»¶ä¸­æ ¹æ® `autoDecodeEnabled` å†³å®šæ˜¾ç¤ºå†…å®¹ï¼š

```typescript
// JsonTree.vue / JsonLineItem.vue
const displayValue = computed(() => {
  if (store.autoDecodeEnabled && node.decodedText) {
    // è‡ªåŠ¨è§£ç å¼€å¯ï¼Œä¸”æœ‰è§£ç å†…å®¹
    return node.decodedText
  } else {
    // è‡ªåŠ¨è§£ç å…³é—­ï¼Œæˆ–æ— è§£ç å†…å®¹
    return node.rawContent
  }
})
```

**æ¸²æŸ“è§„åˆ™ï¼š**
- âœ… **å‹¾é€‰"è‡ªåŠ¨è§£ç "**ï¼š
  - å¦‚æœ `decodedText` éç©ºï¼šæ˜¾ç¤ºè§£ç åçš„å†…å®¹
  - å¦‚æœ `decodedText` ä¸ºç©ºï¼šæ˜¾ç¤º `rawContent`ï¼ˆåŸå§‹å†…å®¹ï¼‰
- âŒ **å–æ¶ˆ"è‡ªåŠ¨è§£ç "**ï¼š
  - å§‹ç»ˆæ˜¾ç¤º `rawContent`ï¼ˆåŸå§‹JSONå­—ç¬¦ä¸²ï¼‰

**æ‰‹åŠ¨åˆ‡æ¢ï¼š**
- å³ä½¿å–æ¶ˆ"è‡ªåŠ¨è§£ç "ï¼Œç”¨æˆ·ä»å¯ç‚¹å‡»èŠ‚ç‚¹æ—è¾¹çš„è§£ç æŒ‰é’®æ‰‹åŠ¨æŸ¥çœ‹è§£ç åçš„å†…å®¹
- æ‰‹åŠ¨è§£ç ä¸å½±å“å…¨å±€ `autoDecodeEnabled` è®¾ç½®

#### ä½œç”¨ 2ï¼šæ§åˆ¶æœç´¢è¡Œä¸ºï¼ˆæ‰€çœ‹å³æ‰€å¾—ï¼‰

åœ¨æœç´¢æ—¶ï¼Œæ ¹æ® `autoDecodeEnabled` é€‰æ‹©æœç´¢çš„æ–‡æœ¬æºï¼š

```typescript
// filter.ts
function matchInLine(
  line: JsonLineNode,
  keyword: string,
  searchMode: SearchMode,
  autoDecodeEnabled: boolean
): boolean {
  // æ‰€çœ‹å³æ‰€å¾—ï¼šæ ¹æ®ç”¨æˆ·çš„æ¸²æŸ“åå¥½é€‰æ‹©æœç´¢æº
  const searchText = (autoDecodeEnabled && line.decodedText)
    ? line.decodedText     // æœç´¢è§£ç åçš„å†…å®¹
    : line.rawContent      // æœç´¢åŸå§‹å†…å®¹

  return matchString(searchText.toLowerCase(), keyword, searchMode)
}
```

**æœç´¢è§„åˆ™ï¼š**
- âœ… **å‹¾é€‰"è‡ªåŠ¨è§£ç "**ï¼š
  - å¦‚æœ `decodedText` éç©ºï¼šåœ¨è§£ç åçš„å†…å®¹ä¸­æœç´¢
  - å¦‚æœ `decodedText` ä¸ºç©ºï¼šåœ¨ `rawContent` ä¸­æœç´¢
- âŒ **å–æ¶ˆ"è‡ªåŠ¨è§£ç "**ï¼š
  - å§‹ç»ˆåœ¨ `rawContent` ä¸­æœç´¢

### 10.4 å®Œæ•´å·¥ä½œæµç¨‹

#### æµç¨‹ 1ï¼šæ–‡ä»¶åŠ è½½ä¸è§£æ

```
ç”¨æˆ·ä¸Šä¼  JSONL æ–‡ä»¶
    â†“
parser.ts è§£ææ¯ä¸€è¡Œ
    â†“
å¯¹æ¯ä¸ª JsonLineNode:
  1. è§£æ JSON â†’ parsedData
  2. è°ƒç”¨ extractDecodedText(parsedData)
     â†’ ç”Ÿæˆ decodedTextï¼ˆå¯èƒ½ä¸ºç©ºï¼‰
  3. ä¿å­˜åˆ° store
```

#### æµç¨‹ 2ï¼šUI æ¸²æŸ“

```
ç”¨æˆ·æŸ¥çœ‹ JSON åˆ—è¡¨
    â†“
ç»„ä»¶è¯»å– store.autoDecodeEnabled
    â†“
å¦‚æœ autoDecodeEnabled = true ä¸” decodedText éç©º:
  â†’ æ˜¾ç¤ºè§£ç åçš„å†…å®¹ï¼ˆæ¢è¡Œã€åµŒå¥—ç»“æ„ç­‰ï¼‰
å¦åˆ™:
  â†’ æ˜¾ç¤ºåŸå§‹ rawContentï¼ˆå¸¦è½¬ä¹‰å­—ç¬¦çš„å­—ç¬¦ä¸²ï¼‰
```

#### æµç¨‹ 3ï¼šç”¨æˆ·åˆ‡æ¢"è‡ªåŠ¨è§£ç "

```
ç”¨æˆ·ç‚¹å‡»"è‡ªåŠ¨è§£ç "å¤é€‰æ¡†
    â†“
è°ƒç”¨ store.toggleAutoDecodeEnabled()
    â†“
autoDecodeEnabled çŠ¶æ€ç¿»è½¬
    â†“
Vue å“åº”å¼ç³»ç»Ÿè§¦å‘é‡æ–°æ¸²æŸ“
    â†“
æ‰€æœ‰ç»„ä»¶æ ¹æ®æ–°çš„ autoDecodeEnabled å€¼é‡æ–°è®¡ç®— displayValue
    â†“
ç•Œé¢ç«‹å³æ›´æ–°ï¼ˆè§£ç  â†” åŸå§‹ï¼‰
```

#### æµç¨‹ 4ï¼šæœç´¢è¿‡æ»¤

```
ç”¨æˆ·è¾“å…¥æœç´¢å…³é”®å­—
    â†“
filter.ts æ‰§è¡Œæœç´¢
    â†“
å¯¹æ¯ä¸ª JsonLineNode:
  1. è¯»å– autoDecodeEnabled çŠ¶æ€
  2. é€‰æ‹©æœç´¢æº:
     - autoDecodeEnabled=true ä¸” decodedText éç©º â†’ åœ¨ decodedText ä¸­æœç´¢
     - å¦åˆ™ â†’ åœ¨ rawContent ä¸­æœç´¢
  3. è¿”å›åŒ¹é…ç»“æœ
    â†“
åªæ˜¾ç¤ºåŒ¹é…çš„è¡Œ/èŠ‚ç‚¹
```

### 10.5 æ€§èƒ½ä¼˜åŒ–è¦ç‚¹

1. **é¢„è®¡ç®—è§£ç **ï¼š
   - è§£ç æ“ä½œåœ¨æ–‡ä»¶åŠ è½½æ—¶ä¸€æ¬¡æ€§å®Œæˆ
   - æœç´¢æ—¶æ— éœ€é‡æ–°è§£ç ï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜çš„ `decodedText`

2. **å†…å­˜ä¼˜åŒ–**ï¼š
   - å¦‚æœä¸éœ€è¦è§£ç ï¼ˆçº¦70%çš„æ•°æ®ï¼‰ï¼Œ`decodedText` ä¸ºç©ºå­—ç¬¦ä¸²
   - é¿å…é‡å¤å­˜å‚¨ç›¸åŒå†…å®¹

3. **å“åº”å¼æ¸²æŸ“**ï¼š
   - Vue çš„å“åº”å¼ç³»ç»Ÿç¡®ä¿ `autoDecodeEnabled` å˜åŒ–æ—¶ç«‹å³é‡æ–°æ¸²æŸ“
   - æ— éœ€æ‰‹åŠ¨åˆ·æ–°æˆ–é‡æ–°è§£ææ•°æ®

### 10.6 ç”¨æˆ·ä½“éªŒ

**åœºæ™¯ Aï¼šæŸ¥çœ‹å¤æ‚åµŒå¥—æ•°æ®**
```jsonl
{"id": 1, "data": "{\"user\":\"Alice\",\"msg\":\"Line1\\nLine2\"}"}
```

1. **å‹¾é€‰"è‡ªåŠ¨è§£ç "**ï¼š
   ```
   id: 1
   data:
     user: "Alice"
     msg: "Line1
           Line2"
   ```
   æœç´¢ "Alice" â†’ âœ… æ‰¾åˆ°ï¼ˆåœ¨è§£ç å†…å®¹ä¸­ï¼‰

2. **å–æ¶ˆ"è‡ªåŠ¨è§£ç "**ï¼š
   ```
   id: 1
   data: "{\"user\":\"Alice\",\"msg\":\"Line1\\nLine2\"}"
   ```
   æœç´¢ "Alice" â†’ âŒ æ‰¾ä¸åˆ°ï¼ˆåœ¨åŸå§‹å­—ç¬¦ä¸²ä¸­æœç´¢éœ€è¦æœ `\"Alice\"`ï¼‰
   æœç´¢ "\\nLine2" â†’ âœ… æ‰¾åˆ°ï¼ˆæœç´¢è½¬ä¹‰åºåˆ—ï¼‰

**åœºæ™¯ Bï¼šæ™®é€šæ•°æ®ï¼ˆæ— éœ€è§£ç ï¼‰**
```jsonl
{"id": 2, "name": "Bob", "age": 30}
```

- `decodedText` = `''`ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰
- æ— è®ºæ˜¯å¦å‹¾é€‰"è‡ªåŠ¨è§£ç "ï¼Œæ˜¾ç¤ºå’Œæœç´¢è¡Œä¸ºä¸€è‡´
- æœç´¢ "Bob" â†’ âœ… å§‹ç»ˆèƒ½æ‰¾åˆ°

### 10.7 å®ç°æ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | èŒè´£ | å…³é”®å‡½æ•°/å˜é‡ |
|------|------|--------------|
| `types.ts` | å®šä¹‰æ•°æ®ç»“æ„ | `JsonLineNode.decodedText`<br>`SearchOptions.autoDecodeEnabled` |
| `decoder.ts` | è§£ç é€»è¾‘ | `extractDecodedText()` |
| `parser.ts` | è§£ææ—¶ç”Ÿæˆç¼“å­˜ | è°ƒç”¨ `extractDecodedText()` |
| `filter.ts` | æœç´¢é€»è¾‘ | `matchInLine()`<br>`filterNodes()` |
| `jsonlStore.ts` | çŠ¶æ€ç®¡ç† | `autoDecodeEnabled`<br>`toggleAutoDecodeEnabled()` |
| `SearchFilter.vue` | UIæ§ä»¶ | å¤é€‰æ¡†ç»‘å®š `autoDecodeEnabled` |
| `JsonTree.vue`<br>`JsonLineItem.vue` | æ¸²æŸ“ç»„ä»¶ | æ ¹æ® `autoDecodeEnabled` é€‰æ‹©æ˜¾ç¤ºå†…å®¹ |

### 10.8 æµ‹è¯•ç”¨ä¾‹

#### æµ‹è¯• 1ï¼šdecodedText ç”Ÿæˆæ­£ç¡®æ€§
```typescript
// è¾“å…¥
const input1 = { msg: "Hello\\nWorld" }
// æœŸæœ›ï¼šdecodedText = "Hello\nWorld"ï¼ˆåŒ…å«å®é™…æ¢è¡Œï¼‰

const input2 = { data: "{\"key\":\"value\"}" }
// æœŸæœ›ï¼šdecodedText åŒ…å«è§£æåçš„åµŒå¥—å†…å®¹

const input3 = { name: "Alice", age: 30 }
// æœŸæœ›ï¼šdecodedText = ''ï¼ˆæ— éœ€è§£ç ï¼‰
```

#### æµ‹è¯• 2ï¼šæ¸²æŸ“åˆ‡æ¢
```typescript
// 1. å‹¾é€‰"è‡ªåŠ¨è§£ç "
store.autoDecodeEnabled = true
// æœŸæœ›ï¼šæ˜¾ç¤ºè§£ç åå†…å®¹ï¼ˆå¦‚æœæœ‰ï¼‰

// 2. å–æ¶ˆ"è‡ªåŠ¨è§£ç "
store.autoDecodeEnabled = false
// æœŸæœ›ï¼šæ˜¾ç¤ºåŸå§‹ rawContent
```

#### æµ‹è¯• 3ï¼šæœç´¢è¡Œä¸ºä¸€è‡´æ€§
```jsonl
{"id": 2, "data": "{\"secret\":\"password\"}"}
```

```typescript
// åœºæ™¯Aï¼šå‹¾é€‰"è‡ªåŠ¨è§£ç "
store.autoDecodeEnabled = true
search("secret")  // âœ… åº”è¯¥æ‰¾åˆ°ï¼ˆåœ¨è§£ç å†…å®¹ä¸­ï¼‰
search("\\\"secret\\\"")  // âŒ æ‰¾ä¸åˆ°ï¼ˆä¸æœåŸå§‹è½¬ä¹‰ï¼‰

// åœºæ™¯Bï¼šå–æ¶ˆ"è‡ªåŠ¨è§£ç "
store.autoDecodeEnabled = false
search("secret")  // âŒ æ‰¾ä¸åˆ°ï¼ˆåœ¨åŸå§‹å­—ç¬¦ä¸²ä¸­ï¼‰
search("\\\"secret\\\"")  // âœ… åº”è¯¥æ‰¾åˆ°ï¼ˆæœè½¬ä¹‰åºåˆ—ï¼‰
```

---
