{"parentUuid": "59ccfb34-d9b8-4a03-ad4c-c48145c7c8ec", "isSidechain": false, "userType": "external", "cwd": "/Users/gongdewei/work/projects/ai-code/ai-code-specs", "sessionId": "5ab6d940-3274-400e-8257-075092a9aeb7", "version": "2.0.1", "gitBranch": "main", "type": "user", "uuid": "a11c919b-dbb2-4117-b8c5-3db0d79e66d2", "timestamp": "2025-12-31T07:21:34.786Z", "toolUseResult": {"type": "text", "file": {"filePath": "/Users/gongdewei/work/projects/ai-code/ai-code-specs/hooks/design-check-hook.sh", "content": "#!/bin/bash\n\n# ============================================================================\n# ä»£ç å˜æ›´å‰ç½®è®¾è®¡æ£€æŸ¥ Hook\n# ============================================================================\n# ç”¨é€”: åœ¨ç”¨æˆ·æäº¤ä»£ç ä¿®æ”¹è¯·æ±‚å‰ï¼Œè‡ªåŠ¨è§¦å‘è®¾è®¡åŸåˆ™æ£€æŸ¥\n# ä½¿ç”¨: é…ç½®ä¸º Claude Code çš„ user-prompt-submit-hook\n# ============================================================================\n\nUSER_PROMPT=\"$1\"\n\n# ä»£ç ä¿®æ”¹å…³é”®è¯åˆ—è¡¨ï¼ˆæ”¯æŒä¸­è‹±æ–‡ï¼‰\nCODE_CHANGE_KEYWORDS=(\n    # æ–°å¢ç±»\n    \"æ·»åŠ \" \"æ–°å¢\" \"åˆ›å»º\" \"å®ç°\" \"å¢åŠ \"\n    \"add\" \"create\" \"implement\" \"new\"\n\n    # ä¿®æ”¹ç±»\n    \"ä¿®æ”¹\" \"æ›´æ”¹\" \"è°ƒæ•´\" \"æ›´æ–°\" \"æ”¹æˆ\" \"å˜æ›´\"\n    \"modify\" \"change\" \"update\" \"alter\" \"refactor\"\n\n    # åˆ é™¤ç±»\n    \"åˆ é™¤\" \"ç§»é™¤\" \"å»æ‰\" \"æ¸…ç†\"\n    \"delete\" \"remove\" \"clean\"\n\n    # ä¼˜åŒ–ç±»\n    \"ä¼˜åŒ–\" \"æ”¹è¿›\" \"æå‡\"\n    \"optimize\" \"improve\" \"enhance\"\n\n    # ä¿®å¤ç±»\n    \"ä¿®å¤\" \"è§£å†³\" \"å¤„ç†é—®é¢˜\" "æ’æŸ¥"\n    \"fix\" \"solve\" \"resolve\" \"debug\"\n\n    # é‡æ„ç±»\n    \"é‡æ„\" \"é‡å†™\"\n    \"refactor\" \"rewrite\"\n)\n\n# æ£€æŸ¥æ˜¯å¦åŒ…å«ä»£ç ä¿®æ”¹å…³é”®è¯\ncontains_code_change_keyword() {\n    local prompt=\"$1\"\n    for keyword in \"${CODE_CHANGE_KEYWORDS[@]}\"; do\n        if echo \"$prompt\" | grep -qi \"$keyword\"; then\n            return 0  # æ‰¾åˆ°å…³é”®è¯\n        fi\n    done\n    return 1  # æœªæ‰¾åˆ°å…³é”®è¯\n}\n\n# æ’é™¤åœºæ™¯ï¼šè¿™äº›æƒ…å†µä¸éœ€è¦è®¾è®¡æ£€æŸ¥\nis_excluded_scenario() {\n    local prompt=\"$1\"\n\n    if echo \"$prompt\" | grep -Eqi \"(ä¿®å¤ç¼–è¯‘|ç»§ç»­æ‰§è¡Œ|ç»§ç»­å¤„ç†|ç»§ç»­ä¿®å¤)\"; then\n        return 0\n    fi\n\n    # æ’é™¤ï¼šçº¯æŸ¥è¯¢/ç†è§£ä»£ç çš„è¯·æ±‚\n    if echo \"$prompt\" | grep -Eqi \"(è§£é‡Š|è¯´æ˜|ä»‹ç»|what|explain|describe|ç†è§£|æŸ¥çœ‹|çœ‹çœ‹|show|display)\"; then\n        # ä½†å¦‚æœåŒæ—¶åŒ…å«ä¿®æ”¹å…³é”®è¯ï¼Œåˆ™ä¸æ’é™¤\n        if ! contains_code_change_keyword \"$prompt\"; then\n            return 0\n        fi\n        return 1\n    fi\n\n    # æ’é™¤ï¼šè¿è¡Œå‘½ä»¤ã€æŸ¥çœ‹æ–‡ä»¶ç­‰éä»£ç ä¿®æ”¹æ“ä½œ\n    if echo \"$prompt\" | grep -Eqi \"^(è¿è¡Œ|æ‰§è¡Œ|æŸ¥çœ‹|è¯»å–|æ˜¾ç¤º|åˆ—å‡º|cat|ls|grep|find|run|execute|show)\"; then\n        # ä½†å¦‚æœåŒæ—¶åŒ…å«ä¿®æ”¹å…³é”®è¯ï¼Œåˆ™ä¸æ’é™¤\n        if ! contains_code_change_keyword \"$prompt\"; then\n            return 0\n        fi\n        return 1\n    fi\n\n\n    # ä½†å¦‚æœåŒæ—¶åŒ…å«ä¿®æ”¹å…³é”®è¯ï¼Œåˆ™ä¸æ’é™¤\n    if ! contains_code_change_keyword \"$prompt\"; then\n        return 0\n    fi\n    return 1\n}\n\n# ä¸»é€»è¾‘\nif is_excluded_scenario \"$USER_PROMPT\"; then\n    # æ’é™¤åœºæ™¯ï¼Œç›´æ¥æ”¾è¡Œ\n    echo \"$USER_PROMPT\"\n    exit 0\nfi\n\nif contains_code_change_keyword \"$USER_PROMPT\"; then\n    # æ£€æµ‹åˆ°ä»£ç ä¿®æ”¹å…³é”®è¯ï¼Œæ³¨å…¥è®¾è®¡æ£€æŸ¥æç¤º\n    cat <<EOF\nâš ï¸  æ£€æµ‹åˆ°ä»£ç å˜æ›´è¯·æ±‚ï¼Œå¯åŠ¨è®¾è®¡æ£€æŸ¥...\n\nã€ç”¨æˆ·åŸå§‹éœ€æ±‚ã€‘\n$USER_PROMPT\n\n---\n\nè¯·ä½¿ç”¨ \\`pre-code-change-guardian\\` Agent å¯¹ä¸Šè¿°éœ€æ±‚è¿›è¡Œè®¾è®¡åŸåˆ™å’Œæ¶æ„ä¸€è‡´æ€§åˆ†æã€‚\n\n**åˆ†æè¦æ±‚**:\n1. æ£€æŸ¥æ˜¯å¦ç¬¦åˆ SOLIDã€DRY ç­‰è®¾è®¡åŸåˆ™\n2. è¯„ä¼°æ˜¯å¦åº”è¯¥ä½¿ç”¨æšä¸¾/å€¼å¯¹è±¡å°è£…çŠ¶æ€å’Œç±»å‹\n3. åˆ¤æ–­æ˜¯å¦éœ€è¦é‡æ„è€Œéå±€éƒ¨ä¿®æ”¹\n4. è¯†åˆ«å¯èƒ½çš„æ¶æ„ä¸€è‡´æ€§é—®é¢˜\n5. å¯¹äºä¿®å¤é—®é¢˜çš„åœºæ™¯ï¼Œåˆ¤æ–­æ˜¯å¦åªæ˜¯æ²»æ ‡ä¸æ²»æœ¬\n6. æ˜¯å¦ä»æ•´ä½“è€ƒè™‘/è®¾è®¡ï¼Œé¿å…ç‚¹çŠ¶æ€ç»´è§£å†³å•ä¸€é—®é¢˜\n\n**æ ¹æ®åˆ†æç»“æœ**:\n- ğŸŸ¢ ä½é£é™©ï¼šç›´æ¥ç»§ç»­å®æ–½ç”¨æˆ·éœ€æ±‚\n- ğŸŸ¡ ä¸­é£é™©ï¼šç»™å‡ºä¼˜åŒ–å»ºè®®ï¼Œä½†å…è®¸ç»§ç»­\n- ğŸ”´ é«˜é£é™©ï¼šæä¾›é‡æ–°è®¾è®¡æ–¹æ¡ˆï¼Œè¦æ±‚ç”¨æˆ·ç¡®è®¤åå†ç»§ç»­\n\nåˆ†æå®Œæˆåï¼Œæ ¹æ®é£é™©ç­‰çº§å’Œç”¨æˆ·å†³ç­–æ‰§è¡Œç›¸åº”æ“ä½œã€‚\nEOF\nelse\n    # æœªæ£€æµ‹åˆ°ä»£ç ä¿®æ”¹å…³é”®è¯ï¼Œç›´æ¥æ”¾è¡Œ\n    echo \"$USER_PROMPT\"\nfi\n", "numLines": 122, "startLine": 1, "totalLines": 122}}}
